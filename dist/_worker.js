var Cu=Object.defineProperty;var Ta=r=>{throw TypeError(r)};var Tu=(r,e,t)=>e in r?Cu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var R=(r,e,t)=>Tu(r,typeof e!="symbol"?e+"":e,t),qn=(r,e,t)=>e.has(r)||Ta("Cannot "+t);var p=(r,e,t)=>(qn(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?Ta("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),C=(r,e,t,s)=>(qn(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),F=(r,e,t)=>(qn(r,e,"access private method"),t);var Ra=(r,e,t,s)=>({set _(n){C(r,e,n,t)},get _(){return p(r,e,s)}});var Wo={Stringify:1,BeforeStream:2,Stream:3},Ce=(r,e)=>{const t=new String(r);return t.isEscaped=!0,t.callbacks=e,t},Ru=/[&<>'"]/,Jo=async(r,e)=>{let t="";e||(e=[]);const s=await Promise.all(r);for(let n=s.length-1;t+=s[n],n--,!(n<0);n--){let i=s[n];typeof i=="object"&&e.push(...i.callbacks||[]);const a=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&e.push(...i.callbacks||[]),i.isEscaped??a)t+=i;else{const o=[t];Ot(i,o),t=o[0]}}return Ce(t,e)},Ot=(r,e)=>{const t=r.search(Ru);if(t===-1){e[0]+=r;return}let s,n,i=0;for(n=t;n<r.length;n++){switch(r.charCodeAt(n)){case 34:s="&quot;";break;case 39:s="&#39;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}e[0]+=r.substring(i,n)+s,i=n+1}e[0]+=r.substring(i,n)},Ko=r=>{const e=r.callbacks;if(!(e!=null&&e.length))return r;const t=[r],s={};return e.forEach(n=>n({phase:Wo.Stringify,buffer:t,context:s})),t[0]},Go=async(r,e,t,s,n)=>{typeof r=="object"&&!(r instanceof String)&&(r instanceof Promise||(r=r.toString()),r instanceof Promise&&(r=await r));const i=r.callbacks;return i!=null&&i.length?(n?n[0]+=r:n=[r],Promise.all(i.map(o=>o({phase:e,buffer:n,context:s}))).then(o=>Promise.all(o.filter(Boolean).map(c=>Go(c,e,!1,s,n))).then(()=>n[0]))):Promise.resolve(r)},$u=(r,...e)=>{const t=[""];for(let s=0,n=r.length-1;s<n;s++){t[0]+=r[s];const i=Array.isArray(e[s])?e[s].flat(1/0):[e[s]];for(let a=0,o=i.length;a<o;a++){const c=i[a];if(typeof c=="string")Ot(c,t);else if(typeof c=="number")t[0]+=c;else{if(typeof c=="boolean"||c===null||c===void 0)continue;if(typeof c=="object"&&c.isEscaped)if(c.callbacks)t.unshift("",c);else{const l=c.toString();l instanceof Promise?t.unshift("",l):t[0]+=l}else c instanceof Promise?t.unshift("",c):Ot(c.toString(),t)}}}return t[0]+=r[r.length-1],t.length===1?"callbacks"in t?Ce(Ko(Ce(t[0],t.callbacks))):Ce(t[0]):Jo(t,t.callbacks)},Ji=Symbol("RENDERER"),yi=Symbol("ERROR_HANDLER"),se=Symbol("STASH"),Xo=Symbol("INTERNAL"),ju=Symbol("MEMO"),hn=Symbol("PERMALINK"),$a=r=>(r[Xo]=!0,r),Qo=r=>({value:e,children:t})=>{if(!t)return;const s={children:[{tag:$a(()=>{r.push(e)}),props:{}}]};Array.isArray(t)?s.children.push(...t.flat()):s.children.push(t),s.children.push({tag:$a(()=>{r.pop()}),props:{}});const n={tag:"",props:s,type:""};return n[yi]=i=>{throw r.pop(),i},n},Yo=r=>{const e=[r],t=Qo(e);return t.values=e,t.Provider=t,br.push(t),t},br=[],ec=r=>{const e=[r],t=s=>{e.push(s.value);let n;try{n=s.children?(Array.isArray(s.children)?new nc("",{},s.children):s.children).toString():""}finally{e.pop()}return n instanceof Promise?n.then(i=>Ce(i,i.callbacks)):Ce(n)};return t.values=e,t.Provider=t,t[Ji]=Qo(e),br.push(t),t},Ar=r=>r.values.at(-1),Xs={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},_i={},Qs="data-precedence",Os=r=>Array.isArray(r)?r:[r],ja=new WeakMap,Ia=(r,e,t,s)=>({buffer:n,context:i})=>{if(!n)return;const a=ja.get(i)||{};ja.set(i,a);const o=a[r]||(a[r]=[]);let c=!1;const l=Xs[r];if(l.length>0){e:for(const[,u]of o)for(const d of l)if(((u==null?void 0:u[d])??null)===(t==null?void 0:t[d])){c=!0;break e}}if(c?n[0]=n[0].replaceAll(e,""):l.length>0?o.push([e,t,s]):o.unshift([e,t,s]),n[0].indexOf("</head>")!==-1){let u;if(s===void 0)u=o.map(([d])=>d);else{const d=[];u=o.map(([h,,m])=>{let g=d.indexOf(m);return g===-1&&(d.push(m),g=d.length-1),[h,g]}).sort((h,m)=>h[1]-m[1]).map(([h])=>h)}u.forEach(d=>{n[0]=n[0].replaceAll(d,"")}),n[0]=n[0].replace(/(?=<\/head>)/,u.join(""))}},Ps=(r,e,t)=>Ce(new qe(r,t,Os(e??[])).toString()),As=(r,e,t,s)=>{if("itemProp"in t)return Ps(r,e,t);let{precedence:n,blocking:i,...a}=t;n=s?n??"":void 0,s&&(a[Qs]=n);const o=new qe(r,a,Os(e||[])).toString();return o instanceof Promise?o.then(c=>Ce(o,[...c.callbacks||[],Ia(r,c,a,n)])):Ce(o,[Ia(r,o,a,n)])},Iu=({children:r,...e})=>{const t=Ki();if(t){const s=Ar(t);if(s==="svg"||s==="head")return new qe("title",e,Os(r??[]))}return As("title",r,e,!1)},Nu=({children:r,...e})=>{const t=Ki();return["src","async"].some(s=>!e[s])||t&&Ar(t)==="head"?Ps("script",r,e):As("script",r,e,!1)},Mu=({children:r,...e})=>["href","precedence"].every(t=>t in e)?(e["data-href"]=e.href,delete e.href,As("style",r,e,!0)):Ps("style",r,e),Lu=({children:r,...e})=>["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?Ps("link",r,e):As("link",r,e,"precedence"in e),Du=({children:r,...e})=>{const t=Ki();return t&&Ar(t)==="head"?Ps("meta",r,e):As("meta",r,e,!1)},tc=(r,{children:e,...t})=>new qe(r,t,Os(e??[])),Uu=r=>(typeof r.action=="function"&&(r.action=hn in r.action?r.action[hn]:void 0),tc("form",r)),rc=(r,e)=>(typeof e.formAction=="function"&&(e.formAction=hn in e.formAction?e.formAction[hn]:void 0),tc(r,e)),Fu=r=>rc("input",r),Bu=r=>rc("button",r);const zn=Object.freeze(Object.defineProperty({__proto__:null,button:Bu,form:Uu,input:Fu,link:Lu,meta:Du,script:Nu,style:Mu,title:Iu},Symbol.toStringTag,{value:"Module"}));var Zu=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),fn=r=>Zu.get(r)||r,sc=(r,e)=>{for(const[t,s]of Object.entries(r)){const n=t[0]==="-"||!/[A-Z]/.test(t)?t:t.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);e(n,s==null?null:typeof s=="number"?n.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${s}`:`${s}px`:s)}},es=void 0,Ki=()=>es,qu=r=>/[A-Z]/.test(r)&&r.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?r.replace(/([A-Z])/g,"-$1").toLowerCase():r,zu=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Vu=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Gi=(r,e)=>{for(let t=0,s=r.length;t<s;t++){const n=r[t];if(typeof n=="string")Ot(n,e);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof qe?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?e[0]+=n:n instanceof Promise?e.unshift("",n):Gi(n,e)}}},qe=class{constructor(r,e,t){R(this,"tag");R(this,"props");R(this,"key");R(this,"children");R(this,"isEscaped",!0);R(this,"localContexts");this.tag=r,this.props=e,this.children=t}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var e,t;const r=[""];(e=this.localContexts)==null||e.forEach(([s,n])=>{s.values.push(n)});try{this.toStringToBuffer(r)}finally{(t=this.localContexts)==null||t.forEach(([s])=>{s.values.pop()})}return r.length===1?"callbacks"in r?Ko(Ce(r[0],r.callbacks)).toString():r[0]:Jo(r,r.callbacks)}toStringToBuffer(r){const e=this.tag,t=this.props;let{children:s}=this;r[0]+=`<${e}`;const n=es&&Ar(es)==="svg"?i=>qu(fn(i)):i=>fn(i);for(let[i,a]of Object.entries(t))if(i=n(i),i!=="children"){if(i==="style"&&typeof a=="object"){let o="";sc(a,(c,l)=>{l!=null&&(o+=`${o?";":""}${c}:${l}`)}),r[0]+=' style="',Ot(o,r),r[0]+='"'}else if(typeof a=="string")r[0]+=` ${i}="`,Ot(a,r),r[0]+='"';else if(a!=null)if(typeof a=="number"||a.isEscaped)r[0]+=` ${i}="${a}"`;else if(typeof a=="boolean"&&Vu.includes(i))a&&(r[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(s.length>0)throw"Can only set one of `children` or `props.dangerouslySetInnerHTML`.";s=[Ce(a.__html)]}else if(a instanceof Promise)r[0]+=` ${i}="`,r.unshift('"',a);else if(typeof a=="function"){if(!i.startsWith("on"))throw`Invalid prop '${i}' of type 'function' supplied to '${e}'.`}else r[0]+=` ${i}="`,Ot(a.toString(),r),r[0]+='"'}if(zu.includes(e)&&s.length===0){r[0]+="/>";return}r[0]+=">",Gi(s,r),r[0]+=`</${e}>`}},Vn=class extends qe{toStringToBuffer(r){const{children:e}=this,t=this.tag.call(null,{...this.props,children:e.length<=1?e[0]:e});if(!(typeof t=="boolean"||t==null))if(t instanceof Promise)if(br.length===0)r.unshift("",t);else{const s=br.map(n=>[n,n.values.at(-1)]);r.unshift("",t.then(n=>(n instanceof qe&&(n.localContexts=s),n)))}else t instanceof qe?t.toStringToBuffer(r):typeof t=="number"||t.isEscaped?(r[0]+=t,t.callbacks&&(r.callbacks||(r.callbacks=[]),r.callbacks.push(...t.callbacks))):Ot(t,r)}},nc=class extends qe{toStringToBuffer(r){Gi(this.children,r)}},Na=(r,e,...t)=>{e??(e={}),t.length&&(e.children=t.length===1?t[0]:t);const s=e.key;delete e.key;const n=Ys(r,e,t);return n.key=s,n},Ma=!1,Ys=(r,e,t)=>{if(!Ma){for(const s in _i)zn[s][Ji]=_i[s];Ma=!0}return typeof r=="function"?new Vn(r,e,t):zn[r]?new Vn(zn[r],e,t):r==="svg"||r==="head"?(es||(es=ec("")),new qe(r,e,[new Vn(es,{value:r},t)])):new qe(r,e,t)},Hu=({children:r})=>new nc("",{children:r},Array.isArray(r)?r:r?[r]:[]);function f(r,e,t){let s;if(!e||!("children"in e))s=Ys(r,e,[]);else{const n=e.children;s=Array.isArray(n)?Ys(r,e,n):Ys(r,e,[n])}return s.key=t,s}var Wu=async(r,e=Object.create(null))=>{const{all:t=!1,dot:s=!1}=e,i=(r instanceof dc?r.raw.headers:r.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?Ju(r,{all:t,dot:s}):{}};async function Ju(r,e){const t=await r.formData();return t?Ku(t,e):{}}function Ku(r,e){const t=Object.create(null);return r.forEach((s,n)=>{e.all||n.endsWith("[]")?Gu(t,n,s):t[n]=s}),e.dot&&Object.entries(t).forEach(([s,n])=>{s.includes(".")&&(Xu(t,s,n),delete t[s])}),t}var Gu=(r,e,t)=>{r[e]!==void 0?Array.isArray(r[e])?r[e].push(t):r[e]=[r[e],t]:r[e]=t},Xu=(r,e,t)=>{let s=r;const n=e.split(".");n.forEach((i,a)=>{a===n.length-1?s[i]=t:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},ic=r=>{const e=r.split("/");return e[0]===""&&e.shift(),e},Qu=r=>{const{groups:e,path:t}=Yu(r),s=ic(t);return ed(s,e)},Yu=r=>{const e=[];return r=r.replace(/\{[^}]+\}/g,(t,s)=>{const n=`@${s}`;return e.push([n,t]),n}),{groups:e,path:r}},ed=(r,e)=>{for(let t=e.length-1;t>=0;t--){const[s]=e[t];for(let n=r.length-1;n>=0;n--)if(r[n].includes(s)){r[n]=r[n].replace(s,e[t][1]);break}}return r},Ds={},La=r=>{if(r==="*")return"*";const e=r.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return e?(Ds[r]||(e[2]?Ds[r]=[r,e[1],new RegExp("^"+e[2]+"$")]:Ds[r]=[r,e[1],!0]),Ds[r]):null},ac=(r,e)=>{try{return e(r)}catch{return r.replace(/(?:%[0-9A-Fa-f]{2})+/g,t=>{try{return e(t)}catch{return t}})}},td=r=>ac(r,decodeURI),oc=r=>{const e=r.url,t=e.indexOf("/",8);let s=t;for(;s<e.length;s++){const n=e.charCodeAt(s);if(n===37){const i=e.indexOf("?",s),a=e.slice(t,i===-1?void 0:i);return td(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return e.slice(t,s)},rd=r=>{const e=oc(r);return e.length>1&&e[e.length-1]==="/"?e.slice(0,-1):e},Ir=(...r)=>{let e="",t=!1;for(let s of r)e[e.length-1]==="/"&&(e=e.slice(0,-1),t=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&t?e=`${e}/`:s!=="/"&&(e=`${e}${s}`),s==="/"&&e===""&&(e="/");return e},cc=r=>{if(!r.match(/\:.+\?$/))return null;const e=r.split("/"),t=[];let s="";return e.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){t.length===0&&s===""?t.push("/"):t.push(s);const i=n.replace("?","");s+="/"+i,t.push(s)}else s+="/"+n}),t.filter((n,i,a)=>a.indexOf(n)===i)},Hn=r=>/[%+]/.test(r)?(r.indexOf("+")!==-1&&(r=r.replace(/\+/g," ")),r.indexOf("%")!==-1?uc(r):r):r,lc=(r,e,t)=>{let s;if(!t&&e&&!/[%+]/.test(e)){let a=r.indexOf(`?${e}`,8);for(a===-1&&(a=r.indexOf(`&${e}`,8));a!==-1;){const o=r.charCodeAt(a+e.length+1);if(o===61){const c=a+e.length+2,l=r.indexOf("&",c);return Hn(r.slice(c,l===-1?void 0:l))}else if(o==38||isNaN(o))return"";a=r.indexOf(`&${e}`,a+1)}if(s=/[%+]/.test(r),!s)return}const n={};s??(s=/[%+]/.test(r));let i=r.indexOf("?",8);for(;i!==-1;){const a=r.indexOf("&",i+1);let o=r.indexOf("=",i);o>a&&a!==-1&&(o=-1);let c=r.slice(i+1,o===-1?a===-1?void 0:a:o);if(s&&(c=Hn(c)),i=a,c==="")continue;let l;o===-1?l="":(l=r.slice(o+1,a===-1?void 0:a),s&&(l=Hn(l))),t?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(l)):n[c]??(n[c]=l)}return e?n[e]:n},sd=lc,nd=(r,e)=>lc(r,e,!0),uc=decodeURIComponent,Da=r=>ac(r,uc),gr,Me,ft,hc,fc,vi,bt,Do,dc=(Do=class{constructor(r,e="/",t=[[]]){M(this,ft);R(this,"raw");M(this,gr);M(this,Me);R(this,"routeIndex",0);R(this,"path");R(this,"bodyCache",{});M(this,bt,r=>{const{bodyCache:e,raw:t}=this,s=e[r];if(s)return s;const n=Object.keys(e)[0];return n?e[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[r]())):e[r]=t[r]()});this.raw=r,this.path=e,C(this,Me,t),C(this,gr,{})}param(r){return r?F(this,ft,hc).call(this,r):F(this,ft,fc).call(this)}query(r){return sd(this.url,r)}queries(r){return nd(this.url,r)}header(r){if(r)return this.raw.headers.get(r.toLowerCase())??void 0;const e={};return this.raw.headers.forEach((t,s)=>{e[s]=t}),e}async parseBody(r){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await Wu(this,r))}json(){return p(this,bt).call(this,"json")}text(){return p(this,bt).call(this,"text")}arrayBuffer(){return p(this,bt).call(this,"arrayBuffer")}blob(){return p(this,bt).call(this,"blob")}formData(){return p(this,bt).call(this,"formData")}addValidatedData(r,e){p(this,gr)[r]=e}valid(r){return p(this,gr)[r]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return p(this,Me)[0].map(([[,r]])=>r)}get routePath(){return p(this,Me)[0].map(([[,r]])=>r)[this.routeIndex].path}},gr=new WeakMap,Me=new WeakMap,ft=new WeakSet,hc=function(r){const e=p(this,Me)[0][this.routeIndex][1][r],t=F(this,ft,vi).call(this,e);return t?/\%/.test(t)?Da(t):t:void 0},fc=function(){const r={},e=Object.keys(p(this,Me)[0][this.routeIndex][1]);for(const t of e){const s=F(this,ft,vi).call(this,p(this,Me)[0][this.routeIndex][1][t]);s&&typeof s=="string"&&(r[t]=/\%/.test(s)?Da(s):s)}return r},vi=function(r){return p(this,Me)[1]?p(this,Me)[1][r]:r},bt=new WeakMap,Do),id="text/plain; charset=UTF-8",Wn=(r,e={})=>{for(const t of Object.keys(e))r.set(t,e[t]);return r},bs,ws,at,Ut,ot,Y,re,Ge,ct,ks,yr,_r,xs,Ss,ve,Ae,Uo,mc=(Uo=class{constructor(r,e){M(this,ve);M(this,bs);M(this,ws);R(this,"env",{});M(this,at);R(this,"finalized",!1);R(this,"error");M(this,Ut,200);M(this,ot);M(this,Y);M(this,re);M(this,Ge);M(this,ct,!0);M(this,ks);M(this,yr);M(this,_r);M(this,xs);M(this,Ss);R(this,"render",(...r)=>(p(this,yr)??C(this,yr,e=>this.html(e)),p(this,yr).call(this,...r)));R(this,"setLayout",r=>C(this,ks,r));R(this,"getLayout",()=>p(this,ks));R(this,"setRenderer",r=>{C(this,yr,r)});R(this,"header",(r,e,t)=>{if(e===void 0){p(this,Y)?p(this,Y).delete(r):p(this,re)&&delete p(this,re)[r.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(r);return}t!=null&&t.append?(p(this,Y)||(C(this,ct,!1),C(this,Y,new Headers(p(this,re))),C(this,re,{})),p(this,Y).append(r,e)):p(this,Y)?p(this,Y).set(r,e):(p(this,re)??C(this,re,{}),p(this,re)[r.toLowerCase()]=e),this.finalized&&(t!=null&&t.append?this.res.headers.append(r,e):this.res.headers.set(r,e))});R(this,"status",r=>{C(this,ct,!1),C(this,Ut,r)});R(this,"set",(r,e)=>{p(this,at)??C(this,at,new Map),p(this,at).set(r,e)});R(this,"get",r=>p(this,at)?p(this,at).get(r):void 0);R(this,"newResponse",(...r)=>F(this,ve,Ae).call(this,...r));R(this,"body",(r,e,t)=>typeof e=="number"?F(this,ve,Ae).call(this,r,e,t):F(this,ve,Ae).call(this,r,e));R(this,"text",(r,e,t)=>{if(!p(this,re)){if(p(this,ct)&&!t&&!e)return new Response(r);C(this,re,{})}return p(this,re)["content-type"]=id,typeof e=="number"?F(this,ve,Ae).call(this,r,e,t):F(this,ve,Ae).call(this,r,e)});R(this,"json",(r,e,t)=>{const s=JSON.stringify(r);return p(this,re)??C(this,re,{}),p(this,re)["content-type"]="application/json; charset=UTF-8",typeof e=="number"?F(this,ve,Ae).call(this,s,e,t):F(this,ve,Ae).call(this,s,e)});R(this,"html",(r,e,t)=>(p(this,re)??C(this,re,{}),p(this,re)["content-type"]="text/html; charset=UTF-8",typeof r=="object"?Go(r,Wo.Stringify,!1,{}).then(s=>typeof e=="number"?F(this,ve,Ae).call(this,s,e,t):F(this,ve,Ae).call(this,s,e)):typeof e=="number"?F(this,ve,Ae).call(this,r,e,t):F(this,ve,Ae).call(this,r,e)));R(this,"redirect",(r,e)=>(p(this,Y)??C(this,Y,new Headers),p(this,Y).set("Location",String(r)),this.newResponse(null,e??302)));R(this,"notFound",()=>(p(this,_r)??C(this,_r,()=>new Response),p(this,_r).call(this,this)));C(this,bs,r),e&&(C(this,ot,e.executionCtx),this.env=e.env,C(this,_r,e.notFoundHandler),C(this,Ss,e.path),C(this,xs,e.matchResult))}get req(){return p(this,ws)??C(this,ws,new dc(p(this,bs),p(this,Ss),p(this,xs))),p(this,ws)}get event(){if(p(this,ot)&&"respondWith"in p(this,ot))return p(this,ot);throw Error("This context has no FetchEvent")}get executionCtx(){if(p(this,ot))return p(this,ot);throw Error("This context has no ExecutionContext")}get res(){return C(this,ct,!1),p(this,Ge)||C(this,Ge,new Response("404 Not Found",{status:404}))}set res(r){if(C(this,ct,!1),p(this,Ge)&&r)try{for(const[e,t]of p(this,Ge).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=p(this,Ge).headers.getSetCookie();r.headers.delete("set-cookie");for(const n of s)r.headers.append("set-cookie",n)}else r.headers.set(e,t)}catch(e){if(e instanceof TypeError&&e.message.includes("immutable")){this.res=new Response(r.body,{headers:r.headers,status:r.status});return}else throw e}C(this,Ge,r),this.finalized=!0}get var(){return p(this,at)?Object.fromEntries(p(this,at)):{}}},bs=new WeakMap,ws=new WeakMap,at=new WeakMap,Ut=new WeakMap,ot=new WeakMap,Y=new WeakMap,re=new WeakMap,Ge=new WeakMap,ct=new WeakMap,ks=new WeakMap,yr=new WeakMap,_r=new WeakMap,xs=new WeakMap,Ss=new WeakMap,ve=new WeakSet,Ae=function(r,e,t){if(p(this,ct)&&!t&&!e&&p(this,Ut)===200)return new Response(r,{headers:p(this,re)});if(e&&typeof e!="number"){const n=new Headers(e.headers);p(this,Y)&&p(this,Y).forEach((a,o)=>{o==="set-cookie"?n.append(o,a):n.set(o,a)});const i=Wn(n,p(this,re));return new Response(r,{headers:i,status:e.status??p(this,Ut)})}const s=typeof e=="number"?e:p(this,Ut);p(this,re)??C(this,re,{}),p(this,Y)??C(this,Y,new Headers),Wn(p(this,Y),p(this,re)),p(this,Ge)&&(p(this,Ge).headers.forEach((n,i)=>{var a,o;i==="set-cookie"?(a=p(this,Y))==null||a.append(i,n):(o=p(this,Y))==null||o.set(i,n)}),Wn(p(this,Y),p(this,re))),t??(t={});for(const[n,i]of Object.entries(t))if(typeof i=="string")p(this,Y).set(n,i);else{p(this,Y).delete(n);for(const a of i)p(this,Y).append(n,a)}return new Response(r,{status:s,headers:p(this,Y)})},Uo),Ua=(r,e,t)=>(s,n)=>{let i=-1;const a=s instanceof mc;return o(0);async function o(c){if(c<=i)throw new Error("next() called multiple times");i=c;let l,u=!1,d;if(r[c]?(d=r[c][0][0],a&&(s.req.routeIndex=c)):d=c===r.length&&n||void 0,!d)a&&s.finalized===!1&&t&&(l=await t(s));else try{l=await d(s,()=>o(c+1))}catch(h){if(h instanceof Error&&a&&e)s.error=h,l=await e(h,s),u=!0;else throw h}return l&&(s.finalized===!1||u)&&(s.res=l),s}},ie="ALL",ad="all",od=["get","post","put","delete","options","patch"],pc="Can not add a route since the matcher is already built.",gc=class extends Error{},cd=Symbol("composedHandler"),ld=r=>r.text("404 Not Found",404),Fa=(r,e)=>"getResponse"in r?r.getResponse():(console.error(r),e.text("Internal Server Error",500)),Le,oe,_c,lt,wt,jt,en,tn,Fo,yc=(Fo=class{constructor(e={}){M(this,oe);R(this,"get");R(this,"post");R(this,"put");R(this,"delete");R(this,"options");R(this,"patch");R(this,"all");R(this,"on");R(this,"use");R(this,"router");R(this,"getPath");R(this,"_basePath","/");M(this,Le,"/");R(this,"routes",[]);M(this,lt,ld);M(this,wt,Fa);R(this,"onError",e=>(C(this,wt,e),this));R(this,"notFound",e=>(C(this,lt,e),this));R(this,"fetch",(e,...t)=>F(this,oe,tn).call(this,e,t[1],t[0],e.method));R(this,"request",(e,t,s,n)=>e instanceof Request?this.fetch(t?new Request(e,t):e,s,n):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${Ir("/",e)}`,t),s,n)));R(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(F(this,oe,tn).call(this,e.request,e,void 0,e.request.method))})});[...od,ad].forEach(n=>{this[n]=(i,...a)=>(typeof i=="string"?C(this,Le,i):F(this,oe,jt).call(this,n,p(this,Le),i),a.forEach(o=>{F(this,oe,jt).call(this,n,p(this,Le),o)}),this)}),this.on=(n,i,...a)=>{for(const o of[i].flat()){C(this,Le,o);for(const c of[n].flat())a.map(l=>{F(this,oe,jt).call(this,c.toUpperCase(),p(this,Le),l)})}return this},this.use=(n,...i)=>(typeof n=="string"?C(this,Le,n):(C(this,Le,"*"),i.unshift(n)),i.forEach(a=>{F(this,oe,jt).call(this,ie,p(this,Le),a)}),this);const s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??oc:rd}route(e,t){const s=this.basePath(e);return t.routes.map(n=>{var a;let i;p(t,wt)===Fa?i=n.handler:(i=async(o,c)=>(await Ua([],p(t,wt))(o,()=>n.handler(o,c))).res,i[cd]=n.handler),F(a=s,oe,jt).call(a,n.method,n.path,i)}),this}basePath(e){const t=F(this,oe,_c).call(this);return t._basePath=Ir(this._basePath,e),t}mount(e,t,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,n=s.replaceRequest));const a=i?c=>{const l=i(c);return Array.isArray(l)?l:[l]}:c=>{let l;try{l=c.executionCtx}catch{}return[c.env,l]};n||(n=(()=>{const c=Ir(this._basePath,e),l=c==="/"?0:c.length;return u=>{const d=new URL(u.url);return d.pathname=d.pathname.slice(l)||"/",new Request(d,u)}})());const o=async(c,l)=>{const u=await t(n(c.req.raw),...a(c));if(u)return u;await l()};return F(this,oe,jt).call(this,ie,Ir(e,"*"),o),this}},Le=new WeakMap,oe=new WeakSet,_c=function(){const e=new yc({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},lt=new WeakMap,wt=new WeakMap,jt=function(e,t,s){e=e.toUpperCase(),t=Ir(this._basePath,t);const n={path:t,method:e,handler:s};this.router.add(e,t,[s,n]),this.routes.push(n)},en=function(e,t){if(e instanceof Error)return p(this,wt).call(this,e,t);throw e},tn=function(e,t,s,n){if(n==="HEAD")return(async()=>new Response(null,await F(this,oe,tn).call(this,e,t,s,"GET")))();const i=this.getPath(e,{env:s}),a=this.router.match(n,i),o=new mc(e,{path:i,matchResult:a,env:s,executionCtx:t,notFoundHandler:p(this,lt)});if(a[0].length===1){let l;try{l=a[0][0][0][0](o,async()=>{o.res=await p(this,lt).call(this,o)})}catch(u){return F(this,oe,en).call(this,u,o)}return l instanceof Promise?l.then(u=>u||(o.finalized?o.res:p(this,lt).call(this,o))).catch(u=>F(this,oe,en).call(this,u,o)):l??p(this,lt).call(this,o)}const c=Ua(a[0],p(this,wt),p(this,lt));return(async()=>{try{const l=await c(o);if(!l.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return l.res}catch(l){return F(this,oe,en).call(this,l,o)}})()},Fo),mn="[^/]+",Jr=".*",Kr="(?:|/.*)",Lr=Symbol(),ud=new Set(".\\+*[^]$()");function dd(r,e){return r.length===1?e.length===1?r<e?-1:1:-1:e.length===1||r===Jr||r===Kr?1:e===Jr||e===Kr?-1:r===mn?1:e===mn?-1:r.length===e.length?r<e?-1:1:e.length-r.length}var Ft,Bt,De,Bo,bi=(Bo=class{constructor(){M(this,Ft);M(this,Bt);M(this,De,Object.create(null))}insert(e,t,s,n,i){if(e.length===0){if(p(this,Ft)!==void 0)throw Lr;if(i)return;C(this,Ft,t);return}const[a,...o]=e,c=a==="*"?o.length===0?["","",Jr]:["","",mn]:a==="/*"?["","",Kr]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let l;if(c){const u=c[1];let d=c[2]||mn;if(u&&c[2]&&(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d)))throw Lr;if(l=p(this,De)[d],!l){if(Object.keys(p(this,De)).some(h=>h!==Jr&&h!==Kr))throw Lr;if(i)return;l=p(this,De)[d]=new bi,u!==""&&C(l,Bt,n.varIndex++)}!i&&u!==""&&s.push([u,p(l,Bt)])}else if(l=p(this,De)[a],!l){if(Object.keys(p(this,De)).some(u=>u.length>1&&u!==Jr&&u!==Kr))throw Lr;if(i)return;l=p(this,De)[a]=new bi}l.insert(o,t,s,n,i)}buildRegExpStr(){const t=Object.keys(p(this,De)).sort(dd).map(s=>{const n=p(this,De)[s];return(typeof p(n,Bt)=="number"?`(${s})@${p(n,Bt)}`:ud.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof p(this,Ft)=="number"&&t.unshift(`#${p(this,Ft)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},Ft=new WeakMap,Bt=new WeakMap,De=new WeakMap,Bo),An,Es,Zo,hd=(Zo=class{constructor(){M(this,An,{varIndex:0});M(this,Es,new bi)}insert(r,e,t){const s=[],n=[];for(let a=0;;){let o=!1;if(r=r.replace(/\{[^}]+\}/g,c=>{const l=`@\\${a}`;return n[a]=[l,c],a++,o=!0,l}),!o)break}const i=r.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[o]=n[a];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(o)!==-1){i[c]=i[c].replace(o,n[a][1]);break}}return p(this,Es).insert(i,e,s,p(this,An),t),s}buildRegExp(){let r=p(this,Es).buildRegExpStr();if(r==="")return[/^$/,[],[]];let e=0;const t=[],s=[];return r=r.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>i!==void 0?(t[++e]=Number(i),"$()"):(a!==void 0&&(s[Number(a)]=++e),"")),[new RegExp(`^${r}`),t,s]}},An=new WeakMap,Es=new WeakMap,Zo),vc=[],fd=[/^$/,[],Object.create(null)],rn=Object.create(null);function bc(r){return rn[r]??(rn[r]=new RegExp(r==="*"?"":`^${r.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,t)=>t?`\\${t}`:"(?:|/.*)")}$`))}function md(){rn=Object.create(null)}function pd(r){var l;const e=new hd,t=[];if(r.length===0)return fd;const s=r.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,d],[h,m])=>u?1:h?-1:d.length-m.length),n=Object.create(null);for(let u=0,d=-1,h=s.length;u<h;u++){const[m,g,y]=s[u];m?n[g]=[y.map(([O])=>[O,Object.create(null)]),vc]:d++;let _;try{_=e.insert(g,d,m)}catch(O){throw O===Lr?new gc(g):O}m||(t[d]=y.map(([O,v])=>{const x=Object.create(null);for(v-=1;v>=0;v--){const[k,T]=_[v];x[k]=T}return[O,x]}))}const[i,a,o]=e.buildRegExp();for(let u=0,d=t.length;u<d;u++)for(let h=0,m=t[u].length;h<m;h++){const g=(l=t[u][h])==null?void 0:l[1];if(!g)continue;const y=Object.keys(g);for(let _=0,O=y.length;_<O;_++)g[y[_]]=o[g[y[_]]]}const c=[];for(const u in a)c[u]=t[a[u]];return[i,c,n]}function Qt(r,e){if(r){for(const t of Object.keys(r).sort((s,n)=>n.length-s.length))if(bc(t).test(e))return[...r[t]]}}var kt,xt,Pr,wc,kc,qo,gd=(qo=class{constructor(){M(this,Pr);R(this,"name","RegExpRouter");M(this,kt);M(this,xt);C(this,kt,{[ie]:Object.create(null)}),C(this,xt,{[ie]:Object.create(null)})}add(r,e,t){var o;const s=p(this,kt),n=p(this,xt);if(!s||!n)throw new Error(pc);s[r]||[s,n].forEach(c=>{c[r]=Object.create(null),Object.keys(c[ie]).forEach(l=>{c[r][l]=[...c[ie][l]]})}),e==="/*"&&(e="*");const i=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=bc(e);r===ie?Object.keys(s).forEach(l=>{var u;(u=s[l])[e]||(u[e]=Qt(s[l],e)||Qt(s[ie],e)||[])}):(o=s[r])[e]||(o[e]=Qt(s[r],e)||Qt(s[ie],e)||[]),Object.keys(s).forEach(l=>{(r===ie||r===l)&&Object.keys(s[l]).forEach(u=>{c.test(u)&&s[l][u].push([t,i])})}),Object.keys(n).forEach(l=>{(r===ie||r===l)&&Object.keys(n[l]).forEach(u=>c.test(u)&&n[l][u].push([t,i]))});return}const a=cc(e)||[e];for(let c=0,l=a.length;c<l;c++){const u=a[c];Object.keys(n).forEach(d=>{var h;(r===ie||r===d)&&((h=n[d])[u]||(h[u]=[...Qt(s[d],u)||Qt(s[ie],u)||[]]),n[d][u].push([t,i-l+c+1]))})}}match(r,e){md();const t=F(this,Pr,wc).call(this);return this.match=(s,n)=>{const i=t[s]||t[ie],a=i[2][n];if(a)return a;const o=n.match(i[0]);if(!o)return[[],vc];const c=o.indexOf("",1);return[i[1][c],o]},this.match(r,e)}},kt=new WeakMap,xt=new WeakMap,Pr=new WeakSet,wc=function(){const r=Object.create(null);return Object.keys(p(this,xt)).concat(Object.keys(p(this,kt))).forEach(e=>{r[e]||(r[e]=F(this,Pr,kc).call(this,e))}),C(this,kt,C(this,xt,void 0)),r},kc=function(r){const e=[];let t=r===ie;return[p(this,kt),p(this,xt)].forEach(s=>{const n=s[r]?Object.keys(s[r]).map(i=>[i,s[r][i]]):[];n.length!==0?(t||(t=!0),e.push(...n)):r!==ie&&e.push(...Object.keys(s[ie]).map(i=>[i,s[ie][i]]))}),t?pd(e):null},qo),St,ut,zo,yd=(zo=class{constructor(r){R(this,"name","SmartRouter");M(this,St,[]);M(this,ut,[]);C(this,St,r.routers)}add(r,e,t){if(!p(this,ut))throw new Error(pc);p(this,ut).push([r,e,t])}match(r,e){if(!p(this,ut))throw new Error("Fatal error");const t=p(this,St),s=p(this,ut),n=t.length;let i=0,a;for(;i<n;i++){const o=t[i];try{for(let c=0,l=s.length;c<l;c++)o.add(...s[c]);a=o.match(r,e)}catch(c){if(c instanceof gc)continue;throw c}this.match=o.match.bind(o),C(this,St,[o]),C(this,ut,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(p(this,ut)||p(this,St).length!==1)throw new Error("No active router has been determined yet.");return p(this,St)[0]}},St=new WeakMap,ut=new WeakMap,zo),Et,pe,Zt,vr,be,dt,It,Vo,xc=(Vo=class{constructor(r,e,t){M(this,dt);M(this,Et);M(this,pe);M(this,Zt);M(this,vr,0);M(this,be,Object.create(null));if(C(this,pe,t||Object.create(null)),C(this,Et,[]),r&&e){const s=Object.create(null);s[r]={handler:e,possibleKeys:[],score:0},C(this,Et,[s])}C(this,Zt,[])}insert(r,e,t){C(this,vr,++Ra(this,vr)._);let s=this;const n=Qu(e),i=[];for(let c=0,l=n.length;c<l;c++){const u=n[c];if(Object.keys(p(s,pe)).includes(u)){s=p(s,pe)[u];const h=La(u);h&&i.push(h[1]);continue}p(s,pe)[u]=new xc;const d=La(u);d&&(p(s,Zt).push(d),i.push(d[1])),s=p(s,pe)[u]}const a=Object.create(null),o={handler:t,possibleKeys:i.filter((c,l,u)=>u.indexOf(c)===l),score:p(this,vr)};return a[r]=o,p(s,Et).push(a),s}search(r,e){const t=[];C(this,be,Object.create(null));let n=[this];const i=ic(e);for(let o=0,c=i.length;o<c;o++){const l=i[o],u=o===c-1,d=[];for(let h=0,m=n.length;h<m;h++){const g=n[h],y=p(g,pe)[l];y&&(C(y,be,p(g,be)),u?(p(y,pe)["*"]&&t.push(...F(this,dt,It).call(this,p(y,pe)["*"],r,p(g,be),Object.create(null))),t.push(...F(this,dt,It).call(this,y,r,p(g,be),Object.create(null)))):d.push(y));for(let _=0,O=p(g,Zt).length;_<O;_++){const v=p(g,Zt)[_],x={...p(g,be)};if(v==="*"){const X=p(g,pe)["*"];X&&(t.push(...F(this,dt,It).call(this,X,r,p(g,be),Object.create(null))),d.push(X));continue}if(l==="")continue;const[k,T,D]=v,j=p(g,pe)[k],me=i.slice(o).join("/");if(D instanceof RegExp&&D.test(me)){x[T]=me,t.push(...F(this,dt,It).call(this,j,r,p(g,be),x));continue}(D===!0||D.test(l))&&(x[T]=l,u?(t.push(...F(this,dt,It).call(this,j,r,x,p(g,be))),p(j,pe)["*"]&&t.push(...F(this,dt,It).call(this,p(j,pe)["*"],r,x,p(g,be)))):(C(j,be,x),d.push(j)))}}n=d}return[t.sort((o,c)=>o.score-c.score).map(({handler:o,params:c})=>[o,c])]}},Et=new WeakMap,pe=new WeakMap,Zt=new WeakMap,vr=new WeakMap,be=new WeakMap,dt=new WeakSet,It=function(r,e,t,s){const n=[];for(let i=0,a=p(r,Et).length;i<a;i++){const o=p(r,Et)[i],c=o[e]||o[ie],l={};if(c!==void 0){c.params=Object.create(null);for(let u=0,d=c.possibleKeys.length;u<d;u++){const h=c.possibleKeys[u],m=l[c.score];c.params[h]=s[h]&&!m?s[h]:t[h]??s[h],l[c.score]=!0}n.push(c)}}return n},Vo),qt,Ho,_d=(Ho=class{constructor(){R(this,"name","TrieRouter");M(this,qt);C(this,qt,new xc)}add(r,e,t){const s=cc(e);if(s){for(let n=0,i=s.length;n<i;n++)p(this,qt).insert(r,s[n],t);return}p(this,qt).insert(r,e,t)}match(r,e){return p(this,qt).search(r,e)}},qt=new WeakMap,Ho),Xi=class extends yc{constructor(r={}){super(r),this.router=r.router??new yd({routers:[new gd,new _d]})}},ts="_hp",vd={Change:"Input",DoubleClick:"DblClick"},bd={svg:"2000/svg",math:"1998/Math/MathML"},rs=[],wi=new WeakMap,wr=void 0,wd=()=>wr,it=r=>"t"in r,Jn={onClick:["click",!1]},Ba=r=>{if(!r.startsWith("on"))return;if(Jn[r])return Jn[r];const e=r.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(e){const[,t,s]=e;return Jn[r]=[(vd[t]||t).toLowerCase(),!!s]}},Za=(r,e)=>wr&&r instanceof SVGElement&&/[A-Z]/.test(e)&&(e in r.style||e.match(/^(?:o|pai|str|u|ve)/))?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,kd=(r,e,t)=>{var s;e||(e={});for(let n in e){const i=e[n];if(n!=="children"&&(!t||t[n]!==i)){n=fn(n);const a=Ba(n);if(a){if((t==null?void 0:t[n])!==i&&(t&&r.removeEventListener(a[0],t[n],a[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${n}" is not a function`);r.addEventListener(a[0],i,a[1])}}else if(n==="dangerouslySetInnerHTML"&&i)r.innerHTML=i.__html;else if(n==="ref"){let o;typeof i=="function"?o=i(r)||(()=>i(null)):i&&"current"in i&&(i.current=r,o=()=>i.current=null),wi.set(r,o)}else if(n==="style"){const o=r.style;typeof i=="string"?o.cssText=i:(o.cssText="",i!=null&&sc(i,o.setProperty.bind(o)))}else{if(n==="value"){const c=r.nodeName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT"){if(r.value=i==null||i===!1?null:i,c==="TEXTAREA"){r.textContent=i;continue}else if(c==="SELECT"){r.selectedIndex===-1&&(r.selectedIndex=0);continue}}}else(n==="checked"&&r.nodeName==="INPUT"||n==="selected"&&r.nodeName==="OPTION")&&(r[n]=i);const o=Za(r,n);i==null||i===!1?r.removeAttribute(o):i===!0?r.setAttribute(o,""):typeof i=="string"||typeof i=="number"?r.setAttribute(o,i):r.setAttribute(o,i.toString())}}}if(t)for(let n in t){const i=t[n];if(n!=="children"&&!(n in e)){n=fn(n);const a=Ba(n);a?r.removeEventListener(a[0],i,a[1]):n==="ref"?(s=wi.get(r))==null||s():r.removeAttribute(Za(r,n))}}},xd=(r,e)=>{e[se][0]=0,rs.push([r,e]);const t=e.tag[Ji]||e.tag,s=t.defaultProps?{...t.defaultProps,...e.props}:e.props;try{return[t.call(null,s)]}finally{rs.pop()}},Sc=(r,e,t,s,n)=>{var i,a;(i=r.vR)!=null&&i.length&&(s.push(...r.vR),delete r.vR),typeof r.tag=="function"&&((a=r[se][1][Ac])==null||a.forEach(o=>n.push(o))),r.vC.forEach(o=>{var c;if(it(o))t.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=e;const l=t.length;if(Sc(o,e,t,s,n),o.s){for(let u=l;u<t.length;u++)t[u].s=!0;o.s=!1}}else t.push(o),(c=o.vR)!=null&&c.length&&(s.push(...o.vR),delete o.vR)})},Sd=r=>{for(;;r=r.tag===ts||!r.vC||!r.pP?r.nN:r.vC[0]){if(!r)return null;if(r.tag!==ts&&r.e)return r.e}},Ec=r=>{var e,t,s,n,i,a;it(r)||((t=(e=r[se])==null?void 0:e[1][Ac])==null||t.forEach(o=>{var c;return(c=o[2])==null?void 0:c.call(o)}),(s=wi.get(r.e))==null||s(),r.p===2&&((n=r.vC)==null||n.forEach(o=>o.p=2)),(i=r.vC)==null||i.forEach(Ec)),r.p||((a=r.e)==null||a.remove(),delete r.e),typeof r.tag=="function"&&(Dr.delete(r),sn.delete(r),delete r[se][3],r.a=!0)},Oc=(r,e,t)=>{r.c=e,Pc(r,e,t)},qa=(r,e)=>{if(e){for(let t=0,s=r.length;t<s;t++)if(r[t]===e)return t}},za=Symbol(),Pc=(r,e,t)=>{var l;const s=[],n=[],i=[];Sc(r,e,s,n,i),n.forEach(Ec);const a=t?void 0:e.childNodes;let o,c=null;if(t)o=-1;else if(!a.length)o=0;else{const u=qa(a,Sd(r.nN));u!==void 0?(c=a[u],o=u):o=qa(a,(l=s.find(d=>d.tag!==ts&&d.e))==null?void 0:l.e)??-1,o===-1&&(t=!0)}for(let u=0,d=s.length;u<d;u++,o++){const h=s[u];let m;if(h.s&&h.e)m=h.e,h.s=!1;else{const g=t||!h.e;it(h)?(h.e&&h.d&&(h.e.textContent=h.t),h.d=!1,m=h.e||(h.e=document.createTextNode(h.t))):(m=h.e||(h.e=h.n?document.createElementNS(h.n,h.tag):document.createElement(h.tag)),kd(m,h.props,h.pP),Pc(h,m,g))}h.tag===ts?o--:t?m.parentNode||e.appendChild(m):a[o]!==m&&a[o-1]!==m&&(a[o+1]===m?e.appendChild(a[o]):e.insertBefore(m,c||a[o]||null))}if(r.pP&&delete r.pP,i.length){const u=[],d=[];i.forEach(([,h,,m,g])=>{h&&u.push(h),m&&d.push(m),g==null||g()}),u.forEach(h=>h()),d.length&&requestAnimationFrame(()=>{d.forEach(h=>h())})}},sn=new WeakMap,ki=(r,e,t)=>{var i,a,o,c,l,u;const s=!t&&e.pC;t&&(e.pC||(e.pC=e.vC));let n;try{t||(t=typeof e.tag=="function"?xd(r,e):Os(e.props.children)),((i=t[0])==null?void 0:i.tag)===""&&t[0][yi]&&(n=t[0][yi],r[5].push([r,n,e]));const d=s?[...e.pC]:e.vC?[...e.vC]:void 0,h=[];let m;for(let g=0;g<t.length;g++){Array.isArray(t[g])&&t.splice(g,1,...t[g].flat());let y=Ed(t[g]);if(y){typeof y.tag=="function"&&!y.tag[Xo]&&(br.length>0&&(y[se][2]=br.map(O=>[O,O.values.at(-1)])),(a=r[5])!=null&&a.length&&(y[se][3]=r[5].at(-1)));let _;if(d&&d.length){const O=d.findIndex(it(y)?v=>it(v):y.key!==void 0?v=>v.key===y.key&&v.tag===y.tag:v=>v.tag===y.tag);O!==-1&&(_=d[O],d.splice(O,1))}if(_)if(it(y))_.t!==y.t&&(_.t=y.t,_.d=!0),y=_;else{const O=_.pP=_.props;_.props=y.props,_.f||(_.f=y.f||e.f),typeof y.tag=="function"&&(_[se][2]=y[se][2]||[],_[se][3]=y[se][3],!_.f&&((_.o||_)===y.o||(c=(o=_.tag)[ju])!=null&&c.call(o,O,_.props))&&(_.s=!0)),y=_}else if(!it(y)&&wr){const O=Ar(wr);O&&(y.n=O)}if(!it(y)&&!y.s&&(ki(r,y),delete y.f),h.push(y),m&&!m.s&&!y.s)for(let O=m;O&&!it(O);O=(l=O.vC)==null?void 0:l.at(-1))O.nN=y;m=y}}e.vR=s?[...e.vC,...d||[]]:d||[],e.vC=h,s&&delete e.pC}catch(d){if(e.f=!0,d===za){if(n)return;throw d}const[h,m,g]=((u=e[se])==null?void 0:u[3])||[];if(m){const y=()=>nn([0,!1,r[2]],g),_=sn.get(g)||[];_.push(y),sn.set(g,_);const O=m(d,()=>{const v=sn.get(g);if(v){const x=v.indexOf(y);if(x!==-1)return v.splice(x,1),y()}});if(O){if(r[0]===1)r[1]=!0;else if(ki(r,g,[O]),(m.length===1||r!==h)&&g.c){Oc(g,g.c,!1);return}throw za}}throw d}finally{n&&r[5].pop()}},Ed=r=>{if(!(r==null||typeof r=="boolean")){if(typeof r=="string"||typeof r=="number")return{t:r.toString(),d:!0};if("vR"in r&&(r={tag:r.tag,props:r.props,key:r.key,f:r.f,type:r.tag,ref:r.props.ref,o:r.o||r}),typeof r.tag=="function")r[se]=[0,[]];else{const e=bd[r.tag];e&&(wr||(wr=Yo("")),r.props.children=[{tag:wr,props:{value:r.n=`http://www.w3.org/${e}`,children:r.props.children}}])}return r}},Va=(r,e)=>{var t,s;(t=e[se][2])==null||t.forEach(([n,i])=>{n.values.push(i)});try{ki(r,e,void 0)}catch{return}if(e.a){delete e.a;return}(s=e[se][2])==null||s.forEach(([n])=>{n.values.pop()}),(r[0]!==1||!r[1])&&Oc(e,e.c,!1)},Dr=new WeakMap,Ha=[],nn=async(r,e)=>{r[5]||(r[5]=[]);const t=Dr.get(e);t&&t[0](void 0);let s;const n=new Promise(i=>s=i);if(Dr.set(e,[s,()=>{r[2]?r[2](r,e,i=>{Va(i,e)}).then(()=>s(e)):(Va(r,e),s(e))}]),Ha.length)Ha.at(-1).add(e);else{await Promise.resolve();const i=Dr.get(e);i&&(Dr.delete(e),i[1]())}return n},Od=(r,e,t)=>({tag:ts,props:{children:r},key:t,e,p:1}),Kn=0,Ac=1,Gn=2,Xn=3,Qn=new WeakMap,Cc=(r,e)=>!r||!e||r.length!==e.length||e.some((t,s)=>t!==r[s]),Pd=void 0,Wa=[],Ad=r=>{var a;const e=()=>typeof r=="function"?r():r,t=rs.at(-1);if(!t)return[e(),()=>{}];const[,s]=t,n=(a=s[se][1])[Kn]||(a[Kn]=[]),i=s[se][0]++;return n[i]||(n[i]=[e(),o=>{const c=Pd,l=n[i];if(typeof o=="function"&&(o=o(l[0])),!Object.is(o,l[0]))if(l[0]=o,Wa.length){const[u,d]=Wa.at(-1);Promise.all([u===3?s:nn([u,!1,c],s),d]).then(([h])=>{if(!h||!(u===2||u===3))return;const m=h.vC;requestAnimationFrame(()=>{setTimeout(()=>{m===h.vC&&nn([u===3?1:0,!1,c],h)})})})}else nn([0,!1,c],s)}])},Qi=(r,e)=>{var o;const t=rs.at(-1);if(!t)return r;const[,s]=t,n=(o=s[se][1])[Gn]||(o[Gn]=[]),i=s[se][0]++,a=n[i];return Cc(a==null?void 0:a[1],e)?n[i]=[r,e]:r=n[i][0],r},Cd=r=>{const e=Qn.get(r);if(e){if(e.length===2)throw e[1];return e[0]}throw r.then(t=>Qn.set(r,[t]),t=>Qn.set(r,[void 0,t])),r},Td=(r,e)=>{var o;const t=rs.at(-1);if(!t)return r();const[,s]=t,n=(o=s[se][1])[Xn]||(o[Xn]=[]),i=s[se][0]++,a=n[i];return Cc(a==null?void 0:a[1],e)&&(n[i]=[r(),e]),n[i][0]},Rd=Yo({pending:!1,data:null,method:null,action:null}),Ja=new Set,$d=r=>{Ja.add(r),r.finally(()=>Ja.delete(r))},Yi=(r,e)=>Td(()=>t=>{let s;r&&(typeof r=="function"?s=r(t)||(()=>{r(null)}):r&&"current"in r&&(r.current=t,s=()=>{r.current=null}));const n=e(t);return()=>{n==null||n(),s==null||s()}},[r]),Yt=Object.create(null),Us=Object.create(null),Cs=(r,e,t,s,n)=>{if(e!=null&&e.itemProp)return{tag:r,props:e,type:r,ref:e.ref};const i=document.head;let{onLoad:a,onError:o,precedence:c,blocking:l,...u}=e,d=null,h=!1;const m=Xs[r];let g;if(m.length>0){const v=i.querySelectorAll(r);e:for(const x of v)for(const k of Xs[r])if(x.getAttribute(k)===e[k]){d=x;break e}if(!d){const x=m.reduce((k,T)=>e[T]===void 0?k:`${k}-${T}-${e[T]}`,r);h=!Us[x],d=Us[x]||(Us[x]=(()=>{const k=document.createElement(r);for(const T of m)e[T]!==void 0&&k.setAttribute(T,e[T]),e.rel&&k.setAttribute("rel",e.rel);return k})())}}else g=i.querySelectorAll(r);c=s?c??"":void 0,s&&(u[Qs]=c);const y=Qi(v=>{if(m.length>0){let x=!1;for(const k of i.querySelectorAll(r)){if(x&&k.getAttribute(Qs)!==c){i.insertBefore(v,k);return}k.getAttribute(Qs)===c&&(x=!0)}i.appendChild(v)}else if(g){let x=!1;for(const k of g)if(k===v){x=!0;break}x||i.insertBefore(v,i.contains(g[0])?g[0]:i.querySelector(r)),g=void 0}},[c]),_=Yi(e.ref,v=>{var T;const x=m[0];if(t===2&&(v.innerHTML=""),(h||g)&&y(v),!o&&!a)return;let k=Yt[T=v.getAttribute(x)]||(Yt[T]=new Promise((D,j)=>{v.addEventListener("load",D),v.addEventListener("error",j)}));a&&(k=k.then(a)),o&&(k=k.catch(o)),k.catch(()=>{})});if(n&&l==="render"){const v=Xs[r][0];if(e[v]){const x=e[v],k=Yt[x]||(Yt[x]=new Promise((T,D)=>{y(d),d.addEventListener("load",T),d.addEventListener("error",D)}));Cd(k)}}const O={tag:r,type:r,props:{...u,ref:_},ref:_};return O.p=t,d&&(O.e=d),Od(O,i)},jd=r=>{const e=wd(),t=e&&Ar(e);return t!=null&&t.endsWith("svg")?{tag:"title",props:r,type:"title",ref:r.ref}:Cs("title",r,void 0,!1,!1)},Id=r=>!r||["src","async"].some(e=>!r[e])?{tag:"script",props:r,type:"script",ref:r.ref}:Cs("script",r,1,!1,!0),Nd=r=>!r||!["href","precedence"].every(e=>e in r)?{tag:"style",props:r,type:"style",ref:r.ref}:(r["data-href"]=r.href,delete r.href,Cs("style",r,2,!0,!0)),Md=r=>!r||["onLoad","onError"].some(e=>e in r)||r.rel==="stylesheet"&&(!("precedence"in r)||"disabled"in r)?{tag:"link",props:r,type:"link",ref:r.ref}:Cs("link",r,1,"precedence"in r,!0),Ld=r=>Cs("meta",r,void 0,!1,!1),Tc=Symbol(),Dd=r=>{const{action:e,...t}=r;typeof e!="function"&&(t.action=e);const[s,n]=Ad([null,!1]),i=Qi(async l=>{const u=l.isTrusted?e:l.detail[Tc];if(typeof u!="function")return;l.preventDefault();const d=new FormData(l.target);n([d,!0]);const h=u(d);h instanceof Promise&&($d(h),await h),n([null,!0])},[]),a=Yi(r.ref,l=>(l.addEventListener("submit",i),()=>{l.removeEventListener("submit",i)})),[o,c]=s;return s[1]=!1,{tag:Rd,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?e:null},children:{tag:"form",props:{...t,ref:a},type:"form",ref:a}},f:c}},Rc=(r,{formAction:e,...t})=>{if(typeof e=="function"){const s=Qi(n=>{n.preventDefault(),n.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Tc]:e}}))},[]);t.ref=Yi(t.ref,n=>(n.addEventListener("click",s),()=>{n.removeEventListener("click",s)}))}return{tag:r,props:t,type:r,ref:t.ref}},Ud=r=>Rc("input",r),Fd=r=>Rc("button",r);Object.assign(_i,{title:jd,script:Id,style:Nd,link:Md,meta:Ld,form:Dd,input:Ud,button:Fd});new TextEncoder;var Bd=ec(null),Zd=(r,e,t,s)=>(n,i)=>{const a="<!DOCTYPE html>",o=t?Na(l=>t(l,r),{Layout:e,...i},n):n,c=$u`${Ce(a)}${Na(Bd.Provider,{value:r},o)}`;return r.html(c)},qd=(r,e)=>function(s,n){const i=s.getLayout()??Hu;return r&&s.setLayout(a=>r({...a,Layout:i},s)),s.setRenderer(Zd(s,i,r)),n()};const zd=qd(({children:r})=>f("html",{lang:"ja",children:[f("head",{children:[f("meta",{charset:"UTF-8"}),f("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),f("link",{rel:"stylesheet",href:"https://unpkg.com/leaflet/dist/leaflet.css"}),f("link",{rel:"stylesheet",href:"https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"}),f("link",{rel:"stylesheet",href:"https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css"}),f("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/simplebar@5.3.6/dist/simplebar.min.css"}),f("script",{type:"text/javascript",src:"https://cdn.jsdelivr.net/npm/simplebar@5.3.6/dist/simplebar.min.js"})]}),f("body",{children:r})]})),Cn=r=>f("body",{children:f("div",{class:"window",children:[f("div",{class:"title-bar",children:[f("span",{class:"title",children:"OmuQue Manager"}),f("div",{class:"buttons",children:[f("button",{class:"minimize",children:"-"}),f("a",{href:"/static/topmenu.html",children:f("button",{id:"close",className:"close",children:"x"})})]})]}),r.children]})}),Vd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Cr).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class ea extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Hd extends ea{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Wd extends ea{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Jd extends ea{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var xi;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(xi||(xi={}));var Kd=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Gd{constructor(e,{headers:t={},customFetch:s,region:n=xi.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Vd(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Kd(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:l}).catch(g=>{throw new Hd(g)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new Wd(u);if(!u.ok)throw new Jd(u);let h=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),m;return h==="application/json"?m=yield u.json():h==="application/octet-stream"?m=yield u.blob():h==="text/event-stream"?m=u:h==="multipart/form-data"?m=yield u.formData():m=yield u.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}var Te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Qd(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var we={},ta={},Tn={},Ts={},Rn={},$n={},Yd=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},kr=Yd();const eh=kr.fetch,$c=kr.fetch.bind(kr),jc=kr.Headers,th=kr.Request,rh=kr.Response,Cr=Object.freeze(Object.defineProperty({__proto__:null,Headers:jc,Request:th,Response:rh,default:$c,fetch:eh},Symbol.toStringTag,{value:"Module"})),sh=Qd(Cr);var jn={};Object.defineProperty(jn,"__esModule",{value:!0});class nh extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}jn.default=nh;var Ic=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($n,"__esModule",{value:!0});const ih=Ic(sh),ah=Ic(jn);let oh=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ih.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let n=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,c;let l=null,u=null,d=null,h=i.status,m=i.statusText;if(i.ok){if(this.method!=="HEAD"){const O=await i.text();O===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=O:u=JSON.parse(O))}const y=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),_=(o=i.headers.get("content-range"))===null||o===void 0?void 0:o.split("/");y&&_&&_.length>1&&(d=parseInt(_[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,h=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const y=await i.text();try{l=JSON.parse(y),Array.isArray(l)&&i.status===404&&(u=[],l=null,h=200,m="OK")}catch{i.status===404&&y===""?(h=204,m="No Content"):l={message:y}}if(l&&this.isMaybeSingle&&(!((c=l==null?void 0:l.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,h=200,m="OK"),l&&this.shouldThrowOnError)throw new ah.default(l)}return{error:l,data:u,count:d,status:h,statusText:m}});return this.shouldThrowOnError||(n=n.catch(i=>{var a,o,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}};$n.default=oh;var ch=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Rn,"__esModule",{value:!0});const lh=ch($n);let uh=class extends lh.default{select(e){let t=!1;const s=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:n,referencedTable:i=n}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const n=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:n=s}={}){const i=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:n=!1,wal:i=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.Accept)!==null&&o!==void 0?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${c};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Rn.default=uh;var dh=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ts,"__esModule",{value:!0});const hh=dh(Rn);let fh=class extends hh.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const n=s?`${s}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ts.default=fh;var mh=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Tn,"__esModule",{value:!0});const Nr=mh(Ts);let ph=class{constructor(e,{headers:t={},schema:s,fetch:n}){this.url=e,this.headers=t,this.schema=s,this.fetch=n}select(e,{head:t=!1,count:s}={}){const n=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),s&&(this.headers.Prefer=`count=${s}`),new Nr.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const n="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),s||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Nr.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:n,defaultToNull:i=!0}={}){const a="POST",o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){const l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Nr.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new Nr.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new Nr.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Tn.default=ph;var In={},Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.version=void 0;Nn.version="0.0.0-automated";Object.defineProperty(In,"__esModule",{value:!0});In.DEFAULT_HEADERS=void 0;const gh=Nn;In.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${gh.version}`};var Nc=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ta,"__esModule",{value:!0});const yh=Nc(Tn),_h=Nc(Ts),vh=In;let bh=class Mc{constructor(e,{headers:t={},schema:s,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},vh.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new yh.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Mc(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:n=!1,count:i}={}){let a;const o=new URL(`${this.url}/rpc/${e}`);let c;s||n?(a=s?"HEAD":"GET",Object.entries(t).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{o.searchParams.append(u,d)})):(a="POST",c=t);const l=Object.assign({},this.headers);return i&&(l.Prefer=`count=${i}`),new _h.default({method:a,url:o,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};ta.default=bh;var Tr=Te&&Te.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(we,"__esModule",{value:!0});we.PostgrestError=we.PostgrestBuilder=we.PostgrestTransformBuilder=we.PostgrestFilterBuilder=we.PostgrestQueryBuilder=we.PostgrestClient=void 0;const Lc=Tr(ta);we.PostgrestClient=Lc.default;const Dc=Tr(Tn);we.PostgrestQueryBuilder=Dc.default;const Uc=Tr(Ts);we.PostgrestFilterBuilder=Uc.default;const Fc=Tr(Rn);we.PostgrestTransformBuilder=Fc.default;const Bc=Tr($n);we.PostgrestBuilder=Bc.default;const Zc=Tr(jn);we.PostgrestError=Zc.default;var wh=we.default={PostgrestClient:Lc.default,PostgrestQueryBuilder:Dc.default,PostgrestFilterBuilder:Uc.default,PostgrestTransformBuilder:Fc.default,PostgrestBuilder:Bc.default,PostgrestError:Zc.default};const{PostgrestClient:kh,PostgrestQueryBuilder:my,PostgrestFilterBuilder:py,PostgrestTransformBuilder:gy,PostgrestBuilder:yy}=wh,xh="2.10.7",Sh={"X-Client-Info":`realtime-js/${xh}`},Eh="1.0.0",qc=1e4,Oh=1e3;var ur;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ur||(ur={}));var Se;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Se||(Se={}));var Ue;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Ue||(Ue={}));var Si;(function(r){r.websocket="websocket"})(Si||(Si={}));var Mt;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Mt||(Mt={}));class Ph{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class zc{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var G;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(G||(G={}));const Ka=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=Ah(a,r,e,n),i),{})},Ah=(r,e,t,s)=>{const n=e.find(o=>o.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?Vc(i,a):Ei(a)},Vc=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return $h(e,t)}switch(r){case G.bool:return Ch(e);case G.float4:case G.float8:case G.int2:case G.int4:case G.int8:case G.numeric:case G.oid:return Th(e);case G.json:case G.jsonb:return Rh(e);case G.timestamp:return jh(e);case G.abstime:case G.date:case G.daterange:case G.int4range:case G.int8range:case G.money:case G.reltime:case G.text:case G.time:case G.timestamptz:case G.timetz:case G.tsrange:case G.tstzrange:return Ei(e);default:return Ei(e)}},Ei=r=>r,Ch=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Th=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Rh=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},$h=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Vc(e,o))}return r},jh=r=>typeof r=="string"?r.replace(" ","T"):r,Hc=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Yn{constructor(e,t,s={},n=qc){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Ga;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Ga||(Ga={}));class Gr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Gr.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=Gr.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Gr.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const d=i[l];if(d){const h=u.map(_=>_.presence_ref),m=d.map(_=>_.presence_ref),g=u.filter(_=>m.indexOf(_.presence_ref)<0),y=d.filter(_=>h.indexOf(_.presence_ref)<0);g.length>0&&(o[l]=g),y.length>0&&(c[l]=y)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const d=e[o].map(m=>m.presence_ref),h=u.filter(m=>d.indexOf(m.presence_ref)<0);e[o].unshift(...h)}s(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(d=>d.presence_ref);l=l.filter(d=>u.indexOf(d.presence_ref)<0),e[o]=l,n(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Xa;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Xa||(Xa={}));var Qa;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Qa||(Qa={}));var Ya;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Ya||(Ya={}));class ra{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Se.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Yn(this,Ue.join,this.params,this.timeout),this.rejoinTimer=new zc(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Se.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Se.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=Se.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Se.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ue.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Gr(this),this.broadcastEndpointURL=Hc(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));const c={},l={broadcast:i,presence:a,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var d;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,m=(d=h==null?void 0:h.length)!==null&&d!==void 0?d:0,g=[];for(let y=0;y<m;y++){const _=h[y],{filter:{event:O,schema:v,table:x,filter:k}}=_,T=u&&u[y];if(T&&T.event===O&&T.schema===v&&T.table===x&&T.filter===k)g.push(Object.assign(Object.assign({},_),{id:T.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,o={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Se.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ue.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new Yn(this,Ue.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Yn(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=Ue;if(s&&[o,c,l,u].indexOf(a)>=0&&s!==this._joinRef())return;let h=this._onMessage(a,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,y,_;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((_=(y=m.filter)===null||y===void 0?void 0:y.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===a}).map(m=>m.callback(h,s)):(i=this.bindings[a])===null||i===void 0||i.filter(m=>{var g,y,_,O,v,x;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const k=m.id,T=(g=m.filter)===null||g===void 0?void 0:g.event;return k&&((y=t.ids)===null||y===void 0?void 0:y.includes(k))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((_=t.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const k=(v=(O=m==null?void 0:m.filter)===null||O===void 0?void 0:O.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return k==="*"||k===((x=t==null?void 0:t.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:y,table:_,commit_timestamp:O,type:v,errors:x}=g;h=Object.assign(Object.assign({},{schema:y,table:_,commit_timestamp:O,eventType:v,new:{},old:{},errors:x}),this._getPayloadRecords(g))}m.callback(h,s)})}_isClosed(){return this.state===Se.closed}_isJoined(){return this.state===Se.joined}_isJoining(){return this.state===Se.joining}_isLeaving(){return this.state===Se.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&ra.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Ue.close,{},e)}_onError(e){this._on(Ue.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Se.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ka(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ka(e.columns,e.old_record)),t}}const Ih=()=>{},Nh=typeof WebSocket<"u",Mh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Lh{constructor(e,t){var s;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=Sh,this.params={},this.timeout=qc,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ih,this.conn=null,this.sendBuffer=[],this.serializer=new Ph,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>Promise.resolve().then(()=>Cr).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${Si.websocket}`,this.httpEndpoint=Hc(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessToken=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new zc(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(Nh){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new Dh(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>ay).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case ur.connecting:return Mt.Connecting;case ur.open:return Mt.Open;case ur.closing:return Mt.Closing;default:return Mt.Closed}}isConnected(){return this.connectionState()===Mt.Open}channel(e,t={config:{}}){const s=new ra(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(Ue.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Eh}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:a}=t;(a&&a===this.pendingHeartbeatRef||n===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(Ue.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Oh,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Mh],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Dh{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=ur.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class sa extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function le(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Uh extends sa{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Oi extends sa{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Fh=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Wc=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Cr).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Bh=()=>Fh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>Cr)).Response:Response}),Pi=r=>{if(Array.isArray(r))return r.map(t=>Pi(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Pi(s)}),e};var Jt=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const ei=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Zh=(r,e,t)=>Jt(void 0,void 0,void 0,function*(){const s=yield Bh();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new Uh(ei(n),r.status||500))}).catch(n=>{e(new Oi(ei(n),n))}):e(new Oi(ei(r),r))}),qh=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function Rs(r,e,t,s,n,i){return Jt(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,qh(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Zh(c,o,s))})})}function pn(r,e,t,s){return Jt(this,void 0,void 0,function*(){return Rs(r,"GET",e,t,s)})}function yt(r,e,t,s,n){return Jt(this,void 0,void 0,function*(){return Rs(r,"POST",e,s,n,t)})}function zh(r,e,t,s,n){return Jt(this,void 0,void 0,function*(){return Rs(r,"PUT",e,s,n,t)})}function Vh(r,e,t,s){return Jt(this,void 0,void 0,function*(){return Rs(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Jc(r,e,t,s,n){return Jt(this,void 0,void 0,function*(){return Rs(r,"DELETE",e,s,n,t)})}var ye=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Hh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eo={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Wh{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Wc(n)}uploadOrUpdate(e,t,s,n){return ye(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},eo),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),h=yield d.json();return d.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(i){if(le(i))return{data:null,error:i};throw i}})}upload(e,t,s){return ye(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return ye(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:eo.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const d=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),h=yield d.json();return d.ok?{data:{path:i,fullPath:h.Key},error:null}:{data:null,error:h}}catch(c){if(le(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return ye(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield yt(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new sa("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(le(s))return{data:null,error:s};throw s}})}update(e,t,s){return ye(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return ye(this,void 0,void 0,function*(){try{return{data:yield yt(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}})}copy(e,t,s){return ye(this,void 0,void 0,function*(){try{return{data:{path:(yield yt(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return ye(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield yt(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return ye(this,void 0,void 0,function*(){try{const n=yield yt(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}})}download(e,t){return ye(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield pn(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(le(o))return{data:null,error:o};throw o}})}info(e){return ye(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield pn(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Pi(s),error:null}}catch(s){if(le(s))return{data:null,error:s};throw s}})}exists(e){return ye(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Vh(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(le(s)&&s instanceof Oi){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return ye(this,void 0,void 0,function*(){try{return{data:yield Jc(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(le(t))return{data:null,error:t};throw t}})}list(e,t,s){return ye(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Hh),t),{prefix:e||""});return{data:yield yt(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(le(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Jh="2.7.1",Kh={"X-Client-Info":`storage-js/${Jh}`};var er=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Gh{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Kh),t),this.fetch=Wc(s)}listBuckets(){return er(this,void 0,void 0,function*(){try{return{data:yield pn(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(le(e))return{data:null,error:e};throw e}})}getBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield pn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(le(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return er(this,void 0,void 0,function*(){try{return{data:yield yt(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(le(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return er(this,void 0,void 0,function*(){try{return{data:yield zh(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(le(s))return{data:null,error:s};throw s}})}emptyBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield yt(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(le(t))return{data:null,error:t};throw t}})}deleteBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield Jc(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(le(t))return{data:null,error:t};throw t}})}}class Xh extends Gh{constructor(e,t={},s){super(e,t,s)}from(e){return new Wh(this.url,this.headers,e,this.fetch)}}const Qh="2.46.1";let Ur="";typeof Deno<"u"?Ur="deno":typeof document<"u"?Ur="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ur="react-native":Ur="node";const Yh={"X-Client-Info":`supabase-js-${Ur}/${Qh}`},ef={headers:Yh},tf={schema:"public"},rf={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},sf={};var nf=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const af=r=>{let e;return r?e=r:typeof fetch>"u"?e=$c:e=fetch,(...t)=>e(...t)},of=()=>typeof Headers>"u"?jc:Headers,cf=(r,e,t)=>{const s=af(t),n=of();return(i,a)=>nf(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:r;let l=new n(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:l}))})};var lf=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};function uf(r){return r.replace(/\/$/,"")}function df(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:a,auth:o,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>lf(this,void 0,void 0,function*(){return""})};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}const Kc="2.65.1",hf="http://localhost:9999",ff="supabase.auth.token",mf={"X-Client-Info":`gotrue-js/${Kc}`},to=10,Ai="X-Supabase-Api-Version",Gc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function pf(r){return Math.round(Date.now()/1e3)+r}function gf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const je=()=>typeof document<"u",Rt={tested:!1,writable:!1},Xr=()=>{if(!je())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rt.tested)return Rt.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Rt.tested=!0,Rt.writable=!0}catch{Rt.tested=!0,Rt.writable=!1}return Rt.writable};function ti(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Xc=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Cr).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},yf=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Qc=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Fs=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Bs=async(r,e)=>{await r.removeItem(e)};function _f(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,n,i,a,o,c,l,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),s=a<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&n!=0&&(t=t+String.fromCharCode(n)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class Mn{constructor(){this.promise=new Mn.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Mn.promiseConstructor=Promise;function ro(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(_f(s))}async function vf(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function bf(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function wf(r){return("0"+r.toString(16)).substr(-2)}function kf(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,wf).join("")}async function xf(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function Sf(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ef(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await xf(r);return Sf(t)}async function tr(r,e,t=!1){const s=kf();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Qc(r,`${e}-code-verifier`,n);const i=await Ef(s);return[i,s===i?"plain":"s256"]}const Of=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Pf(r){const e=r.headers.get(Ai);if(!e||!e.match(Of))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class na extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function U(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Af extends na{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Cf(r){return U(r)&&r.name==="AuthApiError"}class Yc extends na{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Kt extends na{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class pt extends Kt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Tf(r){return U(r)&&r.name==="AuthSessionMissingError"}class ri extends Kt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Zs extends Kt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qs extends Kt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class so extends Kt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ci extends Kt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function si(r){return U(r)&&r.name==="AuthRetryableFetchError"}class no extends Kt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var Rf=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const Nt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),$f=[502,503,504];async function io(r){var e;if(!yf(r))throw new Ci(Nt(r),0);if($f.includes(r.status))throw new Ci(Nt(r),r.status);let t;try{t=await r.json()}catch(i){throw new Yc(Nt(i),i)}let s;const n=Pf(r);if(n&&n.getTime()>=Gc["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new no(Nt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new pt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new no(Nt(t),r.status,t.weak_password.reasons);throw new Af(Nt(t),r.status||500,s)}const jf=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function Z(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Ai]||(i[Ai]=Gc["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await If(r,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function If(r,e,t,s,n,i){const a=jf(e,s,n,i);let o;try{o=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new Ci(Nt(c),0)}if(o.ok||await io(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await io(c)}}function gt(r){var e;let t=null;Df(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=pf(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function ao(r){const e=gt(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function _t(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Nf(r){return{data:r,error:null}}function Mf(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=Rf(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Lf(r){return r}function Df(r){return r.access_token&&r.refresh_token&&r.expires_in}var Uf=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class Ff{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Xc(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Z(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(U(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Z(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Uf(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await Z(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Mf,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(U(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Z(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_t})}catch(t){if(U(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await Z(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Lf});if(u.error)throw u.error;const d=await u.json(),h=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return m.length>0&&(m.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(g.split(";")[1].split("=")[1]);l[`${_}Page`]=y}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(U(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await Z(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_t})}catch(t){if(U(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Z(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await Z(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_t})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await Z(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(U(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Z(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}}}const Bf={getItem:r=>Xr()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{Xr()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{Xr()&&globalThis.localStorage.removeItem(r)}};function oo(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Zf(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const rr={debug:!!(globalThis&&Xr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class el extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class qf extends el{}async function zf(r,e,t){rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),rr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new qf(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(rr.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}Zf();const Vf={url:hf,storageKey:ff,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mf,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Mr=30*1e3,co=3;async function lo(r,e,t){return await t()}class ss{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ss.nextInstanceID,ss.nextInstanceID+=1,this.instanceID>0&&je()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Vf),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ff({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Xc(n.fetch),this.lock=n.lock||lo,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:je()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=zf:this.lock=lo,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:Xr()?this.storage=Bf:(this.memoryStorage={},this.storage=oo(this.memoryStorage)):(this.memoryStorage={},this.storage=oo(this.memoryStorage)),je()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Kc}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const e=je()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:s}=await this._getSessionFromURL(e);if(s)return this._debug("#_initialize()","error detecting session from URL",s),(s==null?void 0:s.code)==="identity_already_exists"?{error:s}:(await this._removeSession(),{error:s});const{session:n,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",n,"redirect type",i),await this._saveSession(n),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return U(e)?{error:e}:{error:new Yc("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await Z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:gt}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(U(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:d,options:h}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await tr(this.storage,this.storageKey)),i=await Z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:d,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:m,code_challenge_method:g},xform:gt})}else if("phone"in e){const{phone:u,password:d,options:h}=e;i=await Z(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(s=h==null?void 0:h.data)!==null&&s!==void 0?s:{},channel:(n=h==null?void 0:h.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:gt})}else throw new Zs("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(U(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await Z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ao})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await Z(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ao})}else throw new Zs("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ri}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await Fs(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await Z(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:gt});if(await Bs(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new ri}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(U(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,o=await Z(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:gt}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new ri}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await tr(this.storage,this.storageKey));const{error:d}=await Z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await Z(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new Zs("You must provide either an email or phone number.")}catch(o){if(U(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await Z(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:gt});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(U(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await tr(this.storage,this.storageKey)),await Z(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Nf})}catch(i){if(U(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new pt;const{error:n}=await Z(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(U(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await Z(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:o}=await Z(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Zs("You must provide either an email or phone number and a type")}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Fs(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_t}):await this._useSession(async t=>{var s,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new pt}:await Z(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:_t})})}catch(t){if(U(t))return Tf(t)&&(await this._removeSession(),await Bs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new pt;const a=n.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await tr(this.storage,this.storageKey));const{data:l,error:u}=await Z(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:_t});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(U(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return ro(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new pt;const t=Date.now()/1e3;let s=t,n=!0,i=null;const a=ro(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(U(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new pt;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(U(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!je())throw new qs("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new qs("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new so("Not a valid PKCE flow url.");const t=ti(window.location.href);if(e){if(!t.code)throw new so("No code detected.");const{data:v,error:x}=await this._exchangeCodeForSession(t.code);if(x)throw x;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:v.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new qs(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=t;if(!i||!o||!a||!l)throw new qs("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(o);let h=u+d;c&&(h=parseInt(c));const m=h-u;m*1e3<=Mr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${d}s`);const g=h-d;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,u);const{data:y,error:_}=await this._getUser(i);if(_)throw _;const O={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:d,expires_at:h,refresh_token:a,token_type:l,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:O,redirectType:t.type},error:null}}catch(t){if(U(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=ti(window.location.href);return!!(je()&&(e.access_token||e.error_description))}async _isPKCEFlow(){const e=ti(window.location.href),t=await Fs(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Cf(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Bs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=gf(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await tr(this.storage,this.storageKey,!0));try{return await Z(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(U(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(U(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,o,c,l,u;const{data:d,error:h}=i;if(h)throw h;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Z(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return je()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(U(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await Z(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await bf(async n=>(n>0&&await vf(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await Z(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:gt})),(n,i)=>{const a=200*Math.pow(2,n);return i&&si(i)&&Date.now()+a-s<Mr})}catch(s){if(this._debug(t,"error",s),U(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),je()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Fs(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+to;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${to}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),si(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new pt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Mn;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new pt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),U(i)){const a={session:null,error:i};return si(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Qc(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Bs(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&je()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Mr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/Mr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Mr}ms, refresh threshold is ${co} ticks`),n<=co&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof el)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!je()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await tr(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await Z(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await Z(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(U(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await Z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(U(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await Z(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(U(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(n.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}ss.nextInstanceID=0;const Hf=ss;class Wf extends Hf{constructor(e){super(e)}}var Jf=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(d){a(d)}}function c(u){try{l(s.throw(u))}catch(d){a(d)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Kf{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=uf(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:tf,realtime:sf,auth:Object.assign(Object.assign({},rf),{storageKey:c}),global:ef},u=df(s??{},l);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=cf(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new kh(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Gd(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Xh(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Jf(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:o,debug:c},l,u){var d;const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Wf({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:(d="Authorization"in this.headers)!==null&&d!==void 0?d:!1})}_initRealtimeClient(e){return new Lh(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?(this.realtime.setAuth(s??null),this.changedAccessToken=s):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Gf=(r,e,t)=>new Kf(r,e,t),Xf="https://inopslkccexruubpuhyr.supabase.co",Qf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlub3BzbGtjY2V4cnV1YnB1aHlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU3NjMzMTUsImV4cCI6MjA0MTMzOTMxNX0.ebVkz6PrThoIJftrh1koO5s0oWqphIx0lVakui4W7_Y",Qe=Gf(Xf,Qf);async function Yf(r,e,t,s){const{data:n,error:i}=await Qe.from("station_master").select("station_id,station_name,lat,lng").gte("lat",r).lte("lat",t).gte("lng",e).lte("lng",s);return i?null:n}async function em(r,e){try{const t=await tl(r,e.openai.shoutengai,e.openai.michi,e.openai.furuiMise,e.openai.shokuSample,e.openai.building,e.openai.chain),s=await tm(r,e.googlemap.localCafe,e.googlemap.chineseRestaurant,e.googlemap.westernRestaurant,e.googlemap.snack);t&&s&&(await rm(r,e.lat,e.lng,t,s,e.index),console.log("All data inserted successfully!"))}catch(t){console.error("Error in registerOmuriceIndex:",t)}}async function tl(r,e,t,s,n,i,a){const{data:o,error:c}=await Qe.from("openai_info").insert([{station_id:r,shoutengai_index:e.index,shoutengai_text:e.text,michi_index:t.index,michi_text:t.text,furui_mise_index:s.index,furui_mise_text:s.text,shoku_sample_index:n.index,shoku_sample_text:n.text,building_index:i.index,building_text:i.text,chain_index:a.index,chain_text:a.text}]).select();if(c)console.error("Error inserting OpenAI info:",c);else return console.log("OpenAI info inserted:",o[0]),o[0].id}async function tm(r,e,t,s,n){const{data:i,error:a}=await Qe.from("googlemap_info").insert([{station_id:r,local_cafe_count:e.count,local_cafe_message:e.message,chinese_restaurant_count:t.count,chinese_restaurant_message:t.message,western_restaurant_count:s.count,western_restaurant_message:s.message,snack_count:n.count,snack_message:n.message}]).select();if(a)console.error("Error inserting Google Map info:",a);else return console.log("Google Map info inserted:",i[0]),i[0].id}async function rm(r,e,t,s,n,i){const{data:a,error:o}=await Qe.from("omurice_index").insert([{station_id:r,lat:e,lng:t,openai_id:s,googlemap_id:n,index:i}]);o?console.error("Error inserting Omurice Index:",o):console.log("Omurice Index inserted:",a)}async function sm(r){try{const{data:e,error:t}=await Qe.from("station_master").select("station_id, station_name, lat, lng").eq("station_id",r).single();if(t)throw console.log(`Cannot find station ID: ${r}
`),t;return e}catch{return null}}async function rl(r,e,t,s){if(!e)return null;console.log(`fetchOID(${r}, ${e}, ${t}, ${s})`);try{const{data:n,error:i}=await Qe.from("omurice_index").select("index, googlemap_id, openai_id").eq("station_id",e).order("created_at",{ascending:!1}).limit(1).single();if(i)throw i;const{index:a,googlemap_id:o,openai_id:c}=n,{data:l,error:u}=await Qe.from("googlemap_info").select("local_cafe_count, local_cafe_message, chinese_restaurant_count, chinese_restaurant_message, western_restaurant_count, western_restaurant_message, snack_count, snack_message").eq("id",o).single();if(u)throw u;const{data:d,error:h}=await Qe.from("openai_info").select("*").eq("id",c).single();if(h)throw h;return{index:a,stationName:r,station_id:e,lat:t,lng:s,googlemap:{localCafe:{count:l.local_cafe_count,message:l.local_cafe_message},chineseRestaurant:{count:l.chinese_restaurant_count,message:l.chinese_restaurant_message},westernRestaurant:{count:l.western_restaurant_count,message:l.western_restaurant_message},snack:{count:l.snack_count,message:l.snack_message}},openai:{shoutengai:{index:d.shoutengai_index,text:d.shoutengai_text},michi:{index:d.michi_index,text:d.michi_text},furuiMise:{index:d.furui_mise_index,text:d.furui_mise_text},shokuSample:{index:d.shoku_sample_index,text:d.shoku_sample_text},building:{index:d.building_index,text:d.building_text},chain:{index:d.chain_index,text:d.chain_text}}}}catch(n){return console.error("Error fetching omurice index data:",n),null}}async function nm(r,e,t,s,n,i){var a;try{const{data:o,error:c}=await Qe.from("omurice_images").insert([{station_name:r,station_id:e,egg:t,rice:s,sauce:n,image_path:i}]).select();return c?(console.error("Error inserting Omurice Data:",c),null):(console.log("Omurice data inserted:",o),((a=o==null?void 0:o[0])==null?void 0:a.id)??null)}catch(o){return console.error("Exception occurred while inserting Omurice Data:",o),null}}const uo=(r,e,t,s)=>{const i=r*Math.PI/180,a=t*Math.PI/180,o=(t-r)*Math.PI/180,c=(s-e)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))};async function sl(r,e,t){const{data:s,error:n}=await Qe.from("station_master").select("*").eq("station_name",r);if(n)throw new Error("Supabase: "+n.message);if(s.length===0)throw new Error("");if(s.length>1){let i=s[0],a=uo(e,t,i.lat,i.lng);for(let o=1;o<s.length;o++){const c=s[o],l=uo(e,t,c.lat,c.lng);l<a&&(a=l,i=c)}return i.station_id}else return s[0].station_id}new Xi;const im=["","TULLYS COFFEE","","","","","","",""],ni=["","","","","","","","","","","","",""," ",""];async function zs(r,e,t,s,n,i,a){let o=0,c=null,l="";do{let u=`https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${e},${t}&radius=${i}&type=${s}&key=${r}&language=ja&keyword=${n}`;c&&(u+=`&pagetoken=${c}`);let d;console.log(u);try{d=await fetch(u)}catch(m){throw console.log(m),new Error("Nearby Search Error")}if(!d.ok)throw new Error("Nearby Search Error: "+d.status);const h=await d.json();if(h.status==="INVALID_REQUEST")return{count:o,message:`${l}`};for(let m of h.results)a.some(g=>m.name.includes(g))||m.business_status==="OPERATIONAL"&&(l+=`${m.name}
`,o++);c=h.next_page_token,console.log(`: ${o}`),c&&await new Promise(m=>setTimeout(m,2e3))}while(c);return{count:o,message:`${l}`}}async function am(r,e,t){try{const s=await zs(r,e,t,"cafe","local",300,im),n=await zs(r,e,t,"restaurant",encodeURIComponent(""),300,ni),i=await zs(r,e,t,"restaurant",encodeURIComponent(""),300,ni),a=await zs(r,e,t,"bar",encodeURIComponent(""),300,ni);return{localCafe:{count:s.count,message:s.message},chineseRestaurant:{count:n.count,message:n.message},westernRestaurant:{count:i.count,message:i.message},snack:{count:a.count,message:a.message}}}catch(s){return console.error(s),null}}const Ti="RFC3986",Ri={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},om="RFC1738",cm=Array.isArray,We=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),ii=1024,lm=(r,e,t,s,n)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=ii){const c=i.length>=ii?i.slice(o,o+ii):i,l=[];for(let u=0;u<c.length;++u){let d=c.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||n===om&&(d===40||d===41)){l[l.length]=c.charAt(u);continue}if(d<128){l[l.length]=We[d];continue}if(d<2048){l[l.length]=We[192|d>>6]+We[128|d&63];continue}if(d<55296||d>=57344){l[l.length]=We[224|d>>12]+We[128|d>>6&63]+We[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=We[240|d>>18]+We[128|d>>12&63]+We[128|d>>6&63]+We[128|d&63]}a+=l.join("")}return a};function um(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function ho(r,e){if(cm(r)){const t=[];for(let s=0;s<r.length;s+=1)t.push(e(r[s]));return t}return e(r)}const dm=Object.prototype.hasOwnProperty,nl={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},Je=Array.isArray,hm=Array.prototype.push,il=function(r,e){hm.apply(r,Je(e)?e:[e])},fm=Date.prototype.toISOString,ae={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:lm,encodeValuesOnly:!1,format:Ti,formatter:Ri[Ti],indices:!1,serializeDate(r){return fm.call(r)},skipNulls:!1,strictNullHandling:!1};function mm(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const ai={};function al(r,e,t,s,n,i,a,o,c,l,u,d,h,m,g,y,_,O){let v=r,x=O,k=0,T=!1;for(;(x=x.get(ai))!==void 0&&!T;){const te=x.get(r);if(k+=1,typeof te<"u"){if(te===k)throw new RangeError("Cyclic object value");T=!0}typeof x.get(ai)>"u"&&(k=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=h==null?void 0:h(v):t==="comma"&&Je(v)&&(v=ho(v,function(te){return te instanceof Date?h==null?void 0:h(te):te})),v===null){if(i)return c&&!y?c(e,ae.encoder,_,"key",m):e;v=""}if(mm(v)||um(v)){if(c){const te=y?e:c(e,ae.encoder,_,"key",m);return[(g==null?void 0:g(te))+"="+(g==null?void 0:g(c(v,ae.encoder,_,"value",m)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(v)))]}const D=[];if(typeof v>"u")return D;let j;if(t==="comma"&&Je(v))y&&c&&(v=ho(v,c)),j=[{value:v.length>0?v.join(",")||null:void 0}];else if(Je(l))j=l;else{const te=Object.keys(v);j=u?te.sort(u):te}const me=o?String(e).replace(/\./g,"%2E"):String(e),X=s&&Je(v)&&v.length===1?me+"[]":me;if(n&&Je(v)&&v.length===0)return X+"[]";for(let te=0;te<j.length;++te){const K=j[te],Xt=typeof K=="object"&&typeof K.value<"u"?K.value:v[K];if(a&&Xt===null)continue;const Zn=d&&o?K.replace(/\./g,"%2E"):K,Au=Je(v)?typeof t=="function"?t(X,Zn):X:X+(d?"."+Zn:"["+Zn+"]");O.set(r,k);const Ca=new WeakMap;Ca.set(ai,O),il(D,al(Xt,Au,t,s,n,i,a,o,t==="comma"&&y&&Je(v)?null:c,l,u,d,h,m,g,y,_,Ca))}return D}function pm(r=ae){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||ae.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ti;if(typeof r.format<"u"){if(!dm.call(Ri,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const s=Ri[t];let n=ae.filter;(typeof r.filter=="function"||Je(r.filter))&&(n=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in nl?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=ae.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:ae.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:ae.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:ae.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:ae.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?ae.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:ae.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:ae.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:ae.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:ae.encodeValuesOnly,filter:n,format:t,formatter:s,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:ae.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:ae.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:ae.strictNullHandling}}function gm(r,e={}){let t=r;const s=pm(e);let n,i;typeof s.filter=="function"?(i=s.filter,t=i("",t)):Je(s.filter)&&(i=s.filter,n=i);const a=[];if(typeof t!="object"||t===null)return"";const o=nl[s.arrayFormat],c=o==="comma"&&s.commaRoundTrip;n||(n=Object.keys(t)),s.sort&&n.sort(s.sort);const l=new WeakMap;for(let h=0;h<n.length;++h){const m=n[h];s.skipNulls&&t[m]===null||il(a,al(t[m],m,o,c,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}const u=a.join(s.delimiter);let d=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}const ir="4.72.0";let fo=!1,Qr,ol,cl,$i,ll,ul,dl,hl,fl;function ym(r,e={auto:!1}){if(fo)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(Qr)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${Qr}'\``);fo=e.auto,Qr=r.kind,ol=r.fetch,cl=r.FormData,$i=r.File,ll=r.ReadableStream,ul=r.getMultipartRequestOptions,dl=r.getDefaultAgent,hl=r.fileFromPath,fl=r.isFsReadStream}class _m{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function vm({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,s,n,i;try{t=fetch,s=Request,n=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:s,Response:n,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new _m(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Qr||ym(vm(),{auto:!0});class B extends Error{}class de extends B{constructor(e,t,s,n){super(`${de.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.request_id=n==null?void 0:n["x-request-id"];const i=t;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,s){const n=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e)return new Ln({message:s,cause:Ii(t)});const i=t==null?void 0:t.error;return e===400?new ml(e,i,s,n):e===401?new pl(e,i,s,n):e===403?new gl(e,i,s,n):e===404?new yl(e,i,s,n):e===409?new _l(e,i,s,n):e===422?new vl(e,i,s,n):e===429?new bl(e,i,s,n):e>=500?new wl(e,i,s,n):new de(e,i,s,n)}}class Fe extends de{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Ln extends de{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class ia extends Ln{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ml extends de{constructor(){super(...arguments),this.status=400}}class pl extends de{constructor(){super(...arguments),this.status=401}}class gl extends de{constructor(){super(...arguments),this.status=403}}class yl extends de{constructor(){super(...arguments),this.status=404}}class _l extends de{constructor(){super(...arguments),this.status=409}}class vl extends de{constructor(){super(...arguments),this.status=422}}class bl extends de{constructor(){super(...arguments),this.status=429}}class wl extends de{}class kl extends B{constructor(){super("Could not parse response content as the length limit was reached")}}class xl extends B{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Vt{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=Vt.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(Vt.NEWLINE_REGEXP);return s&&n.pop(),n.length===1&&!s?(this.buffer.push(n[0]),[]):(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),s||(this.buffer=[n.pop()||""]),n)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new B(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new B(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new B("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Vt.NEWLINE_CHARS=new Set([`
`,"\r"]);Vt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class Xe{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*n(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let i=!1;try{for await(const a of bm(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(o&&o.error)throw new de(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(c){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),c}if(a.event=="error")throw new de(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Xe(n,t)}static fromReadableStream(e,t){let s=!1;async function*n(){const a=new Vt,o=Sl(e);for await(const c of o)for(const l of a.decode(c))yield l;for(const c of a.flush())yield c}async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(const o of n())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Xe(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=i=>({next:()=>{if(i.length===0){const a=s.next();e.push(a),t.push(a)}return i.shift()}});return[new Xe(()=>n(e),this.controller),new Xe(()=>n(t),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new ll({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:i,done:a}=await t.next();if(a)return n.close();const o=s.encode(JSON.stringify(i)+`
`);n.enqueue(o)}catch(i){n.error(i)}},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}}async function*bm(r,e){if(!r.body)throw e.abort(),new B("Attempted to iterate over a response with no body");const t=new xm,s=new Vt,n=Sl(r.body);for await(const i of wm(n))for(const a of s.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of s.flush()){const a=t.decode(i);a&&(yield a)}}async function*wm(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let n=new Uint8Array(e.length+s.length);n.set(e),n.set(s,e.length),e=n;let i;for(;(i=km(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function km(r){for(let s=0;s<r.length-2;s++){if(r[s]===10&&r[s+1]===10||r[s]===13&&r[s+1]===13)return s+2;if(r[s]===13&&r[s+1]===10&&s+3<r.length&&r[s+2]===13&&r[s+3]===10)return s+4}return-1}class xm{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=Sm(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}}function Sm(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function Sl(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const El=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Ol=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Dn(r),Dn=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Em=r=>Ol(r)||El(r)||fl(r);async function Pl(r,e,t){var n;if(r=await r,Ol(r))return r;if(El(r)){const i=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Dn(i)?[await i.arrayBuffer()]:[i];return new $i(a,e,t)}const s=await Om(r);if(e||(e=Am(r)??"unknown_file"),!(t!=null&&t.type)){const i=(n=s[0])==null?void 0:n.type;typeof i=="string"&&(t={...t,type:i})}return new $i(s,e,t)}async function Om(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Dn(r))e.push(await r.arrayBuffer());else if(Cm(r))for await(const s of r)e.push(s);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${Pm(r)}`);return e}function Pm(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function Am(r){var e;return oi(r.name)||oi(r.filename)||((e=oi(r.path))==null?void 0:e.split(/[\\/]/).pop())}const oi=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},Cm=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",mo=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",xr=async r=>{const e=await Tm(r.body);return ul(e,r)},Tm=async r=>{const e=new cl;return await Promise.all(Object.entries(r||{}).map(([t,s])=>ji(e,t,s))),e},ji=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(Em(t)){const s=await Pl(t);r.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>ji(r,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,n])=>ji(r,`${e}[${s}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var dr={},Rm=function(r,e,t,s,n){if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},$m=function(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)},Vs;async function Al(r){const{response:e}=r;if(r.options.stream)return hr("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):Xe.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return hr("response",e.status,e.url,e.headers,i),Cl(i,e)}const n=await e.text();return hr("response",e.status,e.url,e.headers,n),n}function Cl(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Un extends Promise{constructor(e,t=Al){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Un(this.responsePromise,async t=>Cl(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class jm{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:n,fetch:i}){this.baseURL=e,this.maxRetries=ci("maxRetries",t),this.timeout=ci("timeout",s),this.httpAgent=n,this.fetch=i??ol}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Um(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${qm()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async n=>{const i=n&&Dn(n==null?void 0:n.body)?new DataView(await n.body.arrayBuffer()):(n==null?void 0:n.body)instanceof DataView?n.body:(n==null?void 0:n.body)instanceof ArrayBuffer?new DataView(n.body):n&&ArrayBuffer.isView(n==null?void 0:n.body)?new DataView(n.body.buffer):n==null?void 0:n.body;return{method:e,path:t,...n,body:i}}))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var y;const{method:s,path:n,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:mo(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,c=this.calculateContentLength(o),l=this.buildURL(n,i);"timeout"in e&&ci("timeout",e.timeout);const u=e.timeout??this.timeout,d=e.httpAgent??this.httpAgent??dl(l),h=u+1e3;typeof((y=d==null?void 0:d.options)==null?void 0:y.timeout)=="number"&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:e,headers:a,contentLength:c,retryCount:t});return{req:{method:s,...o&&{body:o},headers:m,...d&&{agent:d},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:n}){const i={};s&&(i["content-length"]=s);const a=this.defaultHeaders(e);return _o(i,a),_o(i,t),mo(e.body)&&Qr!=="node"&&delete i["content-type"],vo(a,"x-stainless-retry-count")===void 0&&vo(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(n)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,s,n){return de.generate(e,t,s,n)}request(e,t=null){return new Un(this.makeRequest(e,t))}async makeRequest(e,t){var d,h;const s=await e,n=s.maxRetries??this.maxRetries;t==null&&(t=n),await this.prepareOptions(s);const{req:i,url:a,timeout:o}=this.buildRequest(s,{retryCount:n-t});if(await this.prepareRequest(i,{url:a,options:s}),hr("request",a,s,i.headers),(d=s.signal)!=null&&d.aborted)throw new Fe;const c=new AbortController,l=await this.fetchWithTimeout(a,i,o,c).catch(Ii);if(l instanceof Error){if((h=s.signal)!=null&&h.aborted)throw new Fe;if(t)return this.retryRequest(s,t);throw l.name==="AbortError"?new ia:new Ln({cause:l})}const u=Nm(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const v=`retrying, ${t} attempts remaining`;return hr(`response (error; ${v})`,l.status,a,u),this.retryRequest(s,t,u)}const m=await l.text().catch(v=>Ii(v).message),g=Fm(m),y=g?void 0:m;throw hr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,u,y),this.makeStatusError(l.status,g,y,u)}return{response:l,options:s,controller:c}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new Im(this,s,e)}buildURL(e,t){const s=Zm(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return Rl(n)||(t={...n,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new B(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,n){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>n.abort());const o=setTimeout(()=>n.abort(),s);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s){let n;const i=s==null?void 0:s["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(n=o)}const a=s==null?void 0:s["retry-after"];if(a&&!n){const o=parseFloat(a);Number.isNaN(o)?n=Date.parse(a)-Date.now():n=o*1e3}if(!(n&&0<=n&&n<60*1e3)){const o=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,o)}return await $s(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ir}`}}class Tl{constructor(e,t,s,n){Vs.set(this,void 0),Rm(this,Vs,e),this.options=n,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new B("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[n,i]of s)e.url.searchParams.set(n,i);t.query=void 0,t.path=e.url.toString()}return await $m(this,Vs,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Vs=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Im extends Un{constructor(e,t,s){super(t,async n=>new s(e,n.response,await Al(n),n.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Nm=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),Mm={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ke=r=>typeof r=="object"&&r!==null&&!Rl(r)&&Object.keys(r).every(e=>$l(Mm,e)),Lm=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ir,"X-Stainless-OS":go(Deno.build.os),"X-Stainless-Arch":po(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ir,"X-Stainless-OS":go(process.platform),"X-Stainless-Arch":po(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=Dm();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ir,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Dm(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const s=t.exec(navigator.userAgent);if(s){const n=s[1]||0,i=s[2]||0,a=s[3]||0;return{browser:e,version:`${n}.${i}.${a}`}}}return null}const po=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",go=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let yo;const Um=()=>yo??(yo=Lm()),Fm=r=>{try{return JSON.parse(r)}catch{return}},Bm=new RegExp("^(?:[a-z]+:)?//","i"),Zm=r=>Bm.test(r),$s=r=>new Promise(e=>setTimeout(e,r)),ci=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new B(`${r} must be an integer`);if(e<0)throw new B(`${r} must be a positive integer`);return e},Ii=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Hs=r=>{var e,t,s,n;if(typeof process<"u")return((e=dr==null?void 0:dr[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(n=(s=(t=Deno.env)==null?void 0:t.get)==null?void 0:s.call(t,r))==null?void 0:n.trim()};function Rl(r){if(!r)return!0;for(const e in r)return!1;return!0}function $l(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function _o(r,e){for(const t in e){if(!$l(e,t))continue;const s=t.toLowerCase();if(!s)continue;const n=e[t];n===null?delete r[s]:n!==void 0&&(r[s]=n)}}function hr(r,...e){typeof process<"u"&&(dr==null?void 0:dr.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}const qm=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),zm=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Vm=r=>typeof(r==null?void 0:r.get)=="function",vo=(r,e)=>{var s;const t=e.toLowerCase();if(Vm(r)){const n=((s=e[0])==null?void 0:s.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),n]){const a=r.get(i);if(a)return a}}for(const[n,i]of Object.entries(r))if(n.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function li(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class Hm extends Tl{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class He extends Tl{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var s;const e=this.getPaginatedItems();if(!e.length)return null;const t=(s=e[e.length-1])==null?void 0:s.id;return t?{params:{after:t}}:null}}class W{constructor(e){this._client=e}}let jl=class extends W{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},aa=class extends W{constructor(){super(...arguments),this.completions=new jl(this._client)}};aa.Completions=jl;class Il extends W{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class Nl extends W{create(e,t){return this._client.post("/audio/transcriptions",xr({body:e,...t}))}}class Ml extends W{create(e,t){return this._client.post("/audio/translations",xr({body:e,...t}))}}class js extends W{constructor(){super(...arguments),this.transcriptions=new Nl(this._client),this.translations=new Ml(this._client),this.speech=new Il(this._client)}}js.Transcriptions=Nl;js.Translations=Ml;js.Speech=Il;class oa extends W{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/batches",ca,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class ca extends He{}oa.BatchesPage=ca;class la extends W{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/assistants",ua,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ua extends He{}la.AssistantsPage=ua;function bo(r){return typeof r.parse=="function"}const fr=r=>(r==null?void 0:r.role)==="assistant",Ll=r=>(r==null?void 0:r.role)==="function",Dl=r=>(r==null?void 0:r.role)==="tool";var Ie=function(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},Q=function(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)},Ni,an,on,Fr,Br,cn,Zr,st,qr,gn,yn,ar,Ul;class Fl{constructor(){Ni.add(this),this.controller=new AbortController,an.set(this,void 0),on.set(this,()=>{}),Fr.set(this,()=>{}),Br.set(this,void 0),cn.set(this,()=>{}),Zr.set(this,()=>{}),st.set(this,{}),qr.set(this,!1),gn.set(this,!1),yn.set(this,!1),ar.set(this,!1),Ie(this,an,new Promise((e,t)=>{Ie(this,on,e,"f"),Ie(this,Fr,t,"f")}),"f"),Ie(this,Br,new Promise((e,t)=>{Ie(this,cn,e,"f"),Ie(this,Zr,t,"f")}),"f"),Q(this,an,"f").catch(()=>{}),Q(this,Br,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Q(this,Ni,"m",Ul).bind(this))},0)}_connected(){this.ended||(Q(this,on,"f").call(this),this._emit("connect"))}get ended(){return Q(this,qr,"f")}get errored(){return Q(this,gn,"f")}get aborted(){return Q(this,yn,"f")}abort(){this.controller.abort()}on(e,t){return(Q(this,st,"f")[e]||(Q(this,st,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=Q(this,st,"f")[e];if(!s)return this;const n=s.findIndex(i=>i.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(Q(this,st,"f")[e]||(Q(this,st,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{Ie(this,ar,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){Ie(this,ar,!0,"f"),await Q(this,Br,"f")}_emit(e,...t){if(Q(this,qr,"f"))return;e==="end"&&(Ie(this,qr,!0,"f"),Q(this,cn,"f").call(this));const s=Q(this,st,"f")[e];if(s&&(Q(this,st,"f")[e]=s.filter(n=>!n.once),s.forEach(({listener:n})=>n(...t))),e==="abort"){const n=t[0];!Q(this,ar,"f")&&!(s!=null&&s.length)&&Promise.reject(n),Q(this,Fr,"f").call(this,n),Q(this,Zr,"f").call(this,n),this._emit("end");return}if(e==="error"){const n=t[0];!Q(this,ar,"f")&&!(s!=null&&s.length)&&Promise.reject(n),Q(this,Fr,"f").call(this,n),Q(this,Zr,"f").call(this,n),this._emit("end")}}_emitFinal(){}}an=new WeakMap,on=new WeakMap,Fr=new WeakMap,Br=new WeakMap,cn=new WeakMap,Zr=new WeakMap,st=new WeakMap,qr=new WeakMap,gn=new WeakMap,yn=new WeakMap,ar=new WeakMap,Ni=new WeakSet,Ul=function(e){if(Ie(this,gn,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Fe),e instanceof Fe)return Ie(this,yn,!0,"f"),this._emit("abort",e);if(e instanceof B)return this._emit("error",e);if(e instanceof Error){const t=new B(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new B(String(e)))};function Wm(r,e){const t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Bl(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function Is(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function Jm(r,e){return!e||!Zl(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:da(r,e)}function da(r,e){const t=r.choices.map(s=>{var n;if(s.finish_reason==="length")throw new kl;if(s.finish_reason==="content_filter")throw new xl;return{...s,message:{...s.message,tool_calls:((n=s.message.tool_calls)==null?void 0:n.map(i=>Gm(e,i)))??[],parsed:s.message.content&&!s.message.refusal?Km(e,s.message.content):null}}});return{...r,choices:t}}function Km(r,e){var t,s;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((s=r.response_format)==null?void 0:s.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Gm(r,e){var s;const t=(s=r.tools)==null?void 0:s.find(n=>{var i;return((i=n.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Is(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Xm(r,e){var s;if(!r)return!1;const t=(s=r.tools)==null?void 0:s.find(n=>{var i;return((i=n.function)==null?void 0:i.name)===e.function.name});return Is(t)||(t==null?void 0:t.function.strict)||!1}function Zl(r){var e;return Bl(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>Is(t)||t.type==="function"&&t.function.strict===!0))??!1}function Qm(r){for(const e of r??[]){if(e.type!=="function")throw new B(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new B(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var _e=function(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)},he,Mi,_n,Li,Di,Ui,ql,Fi;const wo=10;class zl extends Fl{constructor(){super(...arguments),he.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var s;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(s=e.choices[0])==null?void 0:s.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ll(e)||Dl(e))&&e.content)this._emit("functionCallResult",e.content);else if(fr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(fr(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new B("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),_e(this,he,"m",Mi).call(this)}async finalMessage(){return await this.done(),_e(this,he,"m",_n).call(this)}async finalFunctionCall(){return await this.done(),_e(this,he,"m",Li).call(this)}async finalFunctionCallResult(){return await this.done(),_e(this,he,"m",Di).call(this)}async totalUsage(){return await this.done(),_e(this,he,"m",Ui).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=_e(this,he,"m",_n).call(this);t&&this._emit("finalMessage",t);const s=_e(this,he,"m",Mi).call(this);s&&this._emit("finalContent",s);const n=_e(this,he,"m",Li).call(this);n&&this._emit("finalFunctionCall",n);const i=_e(this,he,"m",Di).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",_e(this,he,"m",Ui).call(this))}async _createChatCompletion(e,t,s){const n=s==null?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),_e(this,he,"m",ql).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(da(i,t))}async _runChatCompletion(e,t,s){for(const n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){var h;const n="function",{function_call:i="auto",stream:a,...o}=t,c=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=wo}=s||{},u={};for(const m of t.functions)u[m.name||m.function.name]=m;const d=t.functions.map(m=>({name:m.name||m.function.name,parameters:m.parameters,description:m.description}));for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<l;++m){const y=(h=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},s)).choices[0])==null?void 0:h.message;if(!y)throw new B("missing message in ChatCompletion response");if(!y.function_call)return;const{name:_,arguments:O}=y.function_call,v=u[_];if(v){if(c&&c!==_){const D=`Invalid function_call: ${JSON.stringify(_)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,name:_,content:D});continue}}else{const D=`Invalid function_call: ${JSON.stringify(_)}. Available options are: ${d.map(j=>JSON.stringify(j.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:_,content:D});continue}let x;try{x=bo(v)?await v.parse(O):O}catch(D){this._addMessage({role:n,name:_,content:D instanceof Error?D.message:String(D)});continue}const k=await v.function(x,this),T=_e(this,he,"m",Fi).call(this,k);if(this._addMessage({role:n,name:_,content:T}),c)return}}async _runTools(e,t,s){var m,g,y;const n="tool",{tool_choice:i="auto",stream:a,...o}=t,c=typeof i!="string"&&((m=i==null?void 0:i.function)==null?void 0:m.name),{maxChatCompletions:l=wo}=s||{},u=t.tools.map(_=>{if(Is(_)){if(!_.$callback)throw new B("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),d={};for(const _ of u)_.type==="function"&&(d[_.function.name||_.function.function.name]=_.function);const h="tools"in t?u.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(const _ of t.messages)this._addMessage(_,!1);for(let _=0;_<l;++_){const v=(g=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},s)).choices[0])==null?void 0:g.message;if(!v)throw new B("missing message in ChatCompletion response");if(!((y=v.tool_calls)!=null&&y.length))return;for(const x of v.tool_calls){if(x.type!=="function")continue;const k=x.id,{name:T,arguments:D}=x.function,j=d[T];if(j){if(c&&c!==T){const K=`Invalid tool_call: ${JSON.stringify(T)}. ${JSON.stringify(c)} requested. Please try again`;this._addMessage({role:n,tool_call_id:k,content:K});continue}}else{const K=`Invalid tool_call: ${JSON.stringify(T)}. Available options are: ${Object.keys(d).map(Xt=>JSON.stringify(Xt)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:k,content:K});continue}let me;try{me=bo(j)?await j.parse(D):D}catch(K){const Xt=K instanceof Error?K.message:String(K);this._addMessage({role:n,tool_call_id:k,content:Xt});continue}const X=await j.function(me,this),te=_e(this,he,"m",Fi).call(this,X);if(this._addMessage({role:n,tool_call_id:k,content:te}),c)return}}}}he=new WeakSet,Mi=function(){return _e(this,he,"m",_n).call(this).content??null},_n=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(fr(t)){const{function_call:s,...n}=t,i={...n,content:t.content??null,refusal:t.refusal??null};return s&&(i.function_call=s),i}}throw new B("stream ended without producing a ChatCompletionMessage with role=assistant")},Li=function(){var e,t;for(let s=this.messages.length-1;s>=0;s--){const n=this.messages[s];if(fr(n)&&(n!=null&&n.function_call))return n.function_call;if(fr(n)&&((e=n==null?void 0:n.tool_calls)!=null&&e.length))return(t=n.tool_calls.at(-1))==null?void 0:t.function}},Di=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Ll(t)&&t.content!=null||Dl(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>{var n;return s.role==="assistant"&&((n=s.tool_calls)==null?void 0:n.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Ui=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ql=function(e){if(e.n!=null&&e.n>1)throw new B("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Fi=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ns extends zl{static runFunctions(e,t,s){const n=new ns,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,i)),n}static runTools(e,t,s){const n=new ns,i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}_addMessage(e,t=!0){super._addMessage(e,t),fr(e)&&e.content&&this._emit("content",e.content)}}const Vl=1,Hl=2,Wl=4,Jl=8,Kl=16,Gl=32,Xl=64,Ql=128,Yl=256,eu=Ql|Yl,tu=Kl|Gl|eu|Xl,ru=Vl|Hl|tu,su=Wl|Jl,Ym=ru|su,ce={STR:Vl,NUM:Hl,ARR:Wl,OBJ:Jl,NULL:Kl,BOOL:Gl,NAN:Xl,INFINITY:Ql,MINUS_INFINITY:Yl,INF:eu,SPECIAL:tu,ATOM:ru,COLLECTION:su,ALL:Ym};class ep extends Error{}class tp extends Error{}function rp(r,e=ce.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return sp(r.trim(),e)}const sp=(r,e)=>{const t=r.length;let s=0;const n=h=>{throw new ep(`${h} at position ${s}`)},i=h=>{throw new tp(`${h} at position ${s}`)},a=()=>(d(),s>=t&&n("Unexpected end of input"),r[s]==='"'?o():r[s]==="{"?c():r[s]==="["?l():r.substring(s,s+4)==="null"||ce.NULL&e&&t-s<4&&"null".startsWith(r.substring(s))?(s+=4,null):r.substring(s,s+4)==="true"||ce.BOOL&e&&t-s<4&&"true".startsWith(r.substring(s))?(s+=4,!0):r.substring(s,s+5)==="false"||ce.BOOL&e&&t-s<5&&"false".startsWith(r.substring(s))?(s+=5,!1):r.substring(s,s+8)==="Infinity"||ce.INFINITY&e&&t-s<8&&"Infinity".startsWith(r.substring(s))?(s+=8,1/0):r.substring(s,s+9)==="-Infinity"||ce.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(r.substring(s))?(s+=9,-1/0):r.substring(s,s+3)==="NaN"||ce.NAN&e&&t-s<3&&"NaN".startsWith(r.substring(s))?(s+=3,NaN):u()),o=()=>{const h=s;let m=!1;for(s++;s<t&&(r[s]!=='"'||m&&r[s-1]==="\\");)m=r[s]==="\\"?!m:!1,s++;if(r.charAt(s)=='"')try{return JSON.parse(r.substring(h,++s-Number(m)))}catch(g){i(String(g))}else if(ce.STR&e)try{return JSON.parse(r.substring(h,s-Number(m))+'"')}catch{return JSON.parse(r.substring(h,r.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},c=()=>{s++,d();const h={};try{for(;r[s]!=="}";){if(d(),s>=t&&ce.OBJ&e)return h;const m=o();d(),s++;try{const g=a();Object.defineProperty(h,m,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(ce.OBJ&e)return h;throw g}d(),r[s]===","&&s++}}catch{if(ce.OBJ&e)return h;n("Expected '}' at end of object")}return s++,h},l=()=>{s++;const h=[];try{for(;r[s]!=="]";)h.push(a()),d(),r[s]===","&&s++}catch{if(ce.ARR&e)return h;n("Expected ']' at end of array")}return s++,h},u=()=>{if(s===0){r==="-"&&ce.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(r)}catch(m){if(ce.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(m))}}const h=s;for(r[s]==="-"&&s++;r[s]&&!",]}".includes(r[s]);)s++;s==t&&!(ce.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(r.substring(h,s))}catch{r.substring(h,s)==="-"&&ce.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(r.substring(h,r.lastIndexOf("e")))}catch(g){i(String(g))}}},d=()=>{for(;s<t&&` 
\r	`.includes(r[s]);)s++};return a()},ko=r=>rp(r,ce.ALL^ce.NUM);var sr=function(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},J=function(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)},ne,rt,nr,mt,ui,Ws,di,hi,fi,Js,mi,xo;class is extends zl{constructor(e){super(),ne.add(this),rt.set(this,void 0),nr.set(this,void 0),mt.set(this,void 0),sr(this,rt,e,"f"),sr(this,nr,[],"f")}get currentChatCompletionSnapshot(){return J(this,mt,"f")}static fromReadableStream(e){const t=new is(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const n=new is(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){var a;super._createChatCompletion;const n=s==null?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),J(this,ne,"m",ui).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const o of i)J(this,ne,"m",di).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Fe;return this._addChatCompletion(J(this,ne,"m",Js).call(this))}async _fromReadableStream(e,t){var a;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),J(this,ne,"m",ui).call(this),this._connected();const n=Xe.fromReadableStream(e,this.controller);let i;for await(const o of n)i&&i!==o.id&&this._addChatCompletion(J(this,ne,"m",Js).call(this)),J(this,ne,"m",di).call(this,o),i=o.id;if((a=n.controller.signal)!=null&&a.aborted)throw new Fe;return this._addChatCompletion(J(this,ne,"m",Js).call(this))}[(rt=new WeakMap,nr=new WeakMap,mt=new WeakMap,ne=new WeakSet,ui=function(){this.ended||sr(this,mt,void 0,"f")},Ws=function(t){let s=J(this,nr,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},J(this,nr,"f")[t.index]=s,s)},di=function(t){var n,i,a,o,c,l,u,d,h,m,g,y,_,O,v;if(this.ended)return;const s=J(this,ne,"m",xo).call(this,t);this._emit("chunk",t,s);for(const x of t.choices){const k=s.choices[x.index];x.delta.content!=null&&((n=k.message)==null?void 0:n.role)==="assistant"&&((i=k.message)!=null&&i.content)&&(this._emit("content",x.delta.content,k.message.content),this._emit("content.delta",{delta:x.delta.content,snapshot:k.message.content,parsed:k.message.parsed})),x.delta.refusal!=null&&((a=k.message)==null?void 0:a.role)==="assistant"&&((o=k.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:x.delta.refusal,snapshot:k.message.refusal}),((c=x.logprobs)==null?void 0:c.content)!=null&&((l=k.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(u=x.logprobs)==null?void 0:u.content,snapshot:((d=k.logprobs)==null?void 0:d.content)??[]}),((h=x.logprobs)==null?void 0:h.refusal)!=null&&((m=k.message)==null?void 0:m.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=x.logprobs)==null?void 0:g.refusal,snapshot:((y=k.logprobs)==null?void 0:y.refusal)??[]});const T=J(this,ne,"m",Ws).call(this,k);k.finish_reason&&(J(this,ne,"m",fi).call(this,k),T.current_tool_call_index!=null&&J(this,ne,"m",hi).call(this,k,T.current_tool_call_index));for(const D of x.delta.tool_calls??[])T.current_tool_call_index!==D.index&&(J(this,ne,"m",fi).call(this,k),T.current_tool_call_index!=null&&J(this,ne,"m",hi).call(this,k,T.current_tool_call_index)),T.current_tool_call_index=D.index;for(const D of x.delta.tool_calls??[]){const j=(_=k.message.tool_calls)==null?void 0:_[D.index];j!=null&&j.type&&((j==null?void 0:j.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(O=j.function)==null?void 0:O.name,index:D.index,arguments:j.function.arguments,parsed_arguments:j.function.parsed_arguments,arguments_delta:((v=D.function)==null?void 0:v.arguments)??""}):(j==null||j.type,void 0))}}},hi=function(t,s){var a,o,c;if(J(this,ne,"m",Ws).call(this,t).done_tool_calls.has(s))return;const i=(a=t.message.tool_calls)==null?void 0:a[s];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(c=(o=J(this,rt,"f"))==null?void 0:o.tools)==null?void 0:c.find(u=>u.type==="function"&&u.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:s,arguments:i.function.arguments,parsed_arguments:Is(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},fi=function(t){var n,i;const s=J(this,ne,"m",Ws).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;const a=J(this,ne,"m",mi).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(n=t.logprobs)!=null&&n.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Js=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");const t=J(this,mt,"f");if(!t)throw new B("request ended without sending any chunks");return sr(this,mt,void 0,"f"),sr(this,nr,[],"f"),np(t,J(this,rt,"f"))},mi=function(){var s;const t=(s=J(this,rt,"f"))==null?void 0:s.response_format;return Bl(t)?t:null},xo=function(t){var s,n,i,a;let o=J(this,mt,"f");const{choices:c,...l}=t;o?Object.assign(o,l):o=sr(this,mt,{...l,choices:[]},"f");for(const{delta:u,finish_reason:d,index:h,logprobs:m=null,...g}of t.choices){let y=o.choices[h];if(y||(y=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:m,...g}),m)if(!y.logprobs)y.logprobs=Object.assign({},m);else{const{content:D,refusal:j,...me}=m;Object.assign(y.logprobs,me),D&&((s=y.logprobs).content??(s.content=[]),y.logprobs.content.push(...D)),j&&((n=y.logprobs).refusal??(n.refusal=[]),y.logprobs.refusal.push(...j))}if(d&&(y.finish_reason=d,J(this,rt,"f")&&Zl(J(this,rt,"f")))){if(d==="length")throw new kl;if(d==="content_filter")throw new xl}if(Object.assign(y,g),!u)continue;const{content:_,refusal:O,function_call:v,role:x,tool_calls:k,...T}=u;if(Object.assign(y.message,T),O&&(y.message.refusal=(y.message.refusal||"")+O),x&&(y.message.role=x),v&&(y.message.function_call?(v.name&&(y.message.function_call.name=v.name),v.arguments&&((i=y.message.function_call).arguments??(i.arguments=""),y.message.function_call.arguments+=v.arguments)):y.message.function_call=v),_&&(y.message.content=(y.message.content||"")+_,!y.message.refusal&&J(this,ne,"m",mi).call(this)&&(y.message.parsed=ko(y.message.content))),k){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:D,id:j,type:me,function:X,...te}of k){const K=(a=y.message.tool_calls)[D]??(a[D]={});Object.assign(K,te),j&&(K.id=j),me&&(K.type=me),X&&(K.function??(K.function={name:X.name??"",arguments:""})),X!=null&&X.name&&(K.function.name=X.name),X!=null&&X.arguments&&(K.function.arguments+=X.arguments,Xm(J(this,rt,"f"),K)&&(K.function.parsed_arguments=ko(K.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",n=>{const i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(const n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(const i of t)i.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(const i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function np(r,e){const{id:t,choices:s,created:n,model:i,system_fingerprint:a,...o}=r,c={...o,id:t,choices:s.map(({message:l,finish_reason:u,index:d,logprobs:h,...m})=>{if(!u)throw new B(`missing finish_reason for choice ${d}`);const{content:g=null,function_call:y,tool_calls:_,...O}=l,v=l.role;if(!v)throw new B(`missing role for choice ${d}`);if(y){const{arguments:x,name:k}=y;if(x==null)throw new B(`missing function_call.arguments for choice ${d}`);if(!k)throw new B(`missing function_call.name for choice ${d}`);return{...m,message:{content:g,function_call:{arguments:x,name:k},role:v,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:h}}return _?{...m,index:d,finish_reason:u,logprobs:h,message:{...O,role:v,content:g,refusal:l.refusal??null,tool_calls:_.map((x,k)=>{const{function:T,type:D,id:j,...me}=x,{arguments:X,name:te,...K}=T||{};if(j==null)throw new B(`missing choices[${d}].tool_calls[${k}].id
${Ks(r)}`);if(D==null)throw new B(`missing choices[${d}].tool_calls[${k}].type
${Ks(r)}`);if(te==null)throw new B(`missing choices[${d}].tool_calls[${k}].function.name
${Ks(r)}`);if(X==null)throw new B(`missing choices[${d}].tool_calls[${k}].function.arguments
${Ks(r)}`);return{...me,id:j,type:D,function:{...K,name:te,arguments:X}}})}}:{...m,message:{...O,content:g,role:v,refusal:l.refusal??null},finish_reason:u,index:d,logprobs:h}}),created:n,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return Jm(c,e)}function Ks(r){return JSON.stringify(r)}class mr extends is{static fromReadableStream(e){const t=new mr(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){const n=new mr(null),i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,i)),n}static runTools(e,t,s){const n=new mr(t),i={...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}}let nu=class extends W{parse(e,t){return Qm(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>da(s,e))}runFunctions(e,t){return e.stream?mr.runFunctions(this._client,e,t):ns.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?mr.runTools(this._client,e,t):ns.runTools(this._client,e,t)}stream(e,t){return is.createChatCompletion(this._client,e,t)}};class Bi extends W{constructor(){super(...arguments),this.completions=new nu(this._client)}}(function(r){r.Completions=nu})(Bi||(Bi={}));var A=function(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)},xe=function(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t},ue,Zi,Ke,ln,Ne,Dt,cr,Lt,vn,Ee,un,dn,Yr,zr,Vr,So,Eo,Oo,Po,Ao,Co,To;class Be extends Fl{constructor(){super(...arguments),ue.add(this),Zi.set(this,[]),Ke.set(this,{}),ln.set(this,{}),Ne.set(this,void 0),Dt.set(this,void 0),cr.set(this,void 0),Lt.set(this,void 0),vn.set(this,void 0),Ee.set(this,void 0),un.set(this,void 0),dn.set(this,void 0),Yr.set(this,void 0)}[(Zi=new WeakMap,Ke=new WeakMap,ln=new WeakMap,Ne=new WeakMap,Dt=new WeakMap,cr=new WeakMap,Lt=new WeakMap,vn=new WeakMap,Ee=new WeakMap,un=new WeakMap,dn=new WeakMap,Yr=new WeakMap,ue=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",n=>{const i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(const n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(const i of t)i.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(const i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Be;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const s=t==null?void 0:t.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const n=Xe.fromReadableStream(e,this.controller);for await(const a of n)A(this,ue,"m",zr).call(this,a);if((i=n.controller.signal)!=null&&i.aborted)throw new Fe;return this._addRun(A(this,ue,"m",Vr).call(this))}toReadableStream(){return new Xe(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n,i){const a=new Be;return a._run(()=>a._runToolAssistantStream(e,t,s,n,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,s,n,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...n,stream:!0},c=await e.submitToolOutputs(t,s,o,{...i,signal:this.controller.signal});this._connected();for await(const u of c)A(this,ue,"m",zr).call(this,u);if((l=c.controller.signal)!=null&&l.aborted)throw new Fe;return this._addRun(A(this,ue,"m",Vr).call(this))}static createThreadAssistantStream(e,t,s){const n=new Be;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){const i=new Be;return i._run(()=>i._runAssistantStream(e,t,s,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return A(this,un,"f")}currentRun(){return A(this,dn,"f")}currentMessageSnapshot(){return A(this,Ne,"f")}currentRunStepSnapshot(){return A(this,Yr,"f")}async finalRunSteps(){return await this.done(),Object.values(A(this,Ke,"f"))}async finalMessages(){return await this.done(),Object.values(A(this,ln,"f"))}async finalRun(){if(await this.done(),!A(this,Dt,"f"))throw Error("Final run was not received.");return A(this,Dt,"f")}async _createThreadAssistantStream(e,t,s){var o;const n=s==null?void 0:s.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...s,signal:this.controller.signal});this._connected();for await(const c of a)A(this,ue,"m",zr).call(this,c);if((o=a.controller.signal)!=null&&o.aborted)throw new Fe;return this._addRun(A(this,ue,"m",Vr).call(this))}async _createAssistantStream(e,t,s,n){var c;const i=n==null?void 0:n.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...s,stream:!0},o=await e.create(t,a,{...n,signal:this.controller.signal});this._connected();for await(const l of o)A(this,ue,"m",zr).call(this,l);if((c=o.controller.signal)!=null&&c.aborted)throw new Fe;return this._addRun(A(this,ue,"m",Vr).call(this))}static accumulateDelta(e,t){for(const[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let i=e[s];if(i==null){e[s]=n;continue}if(s==="index"||s==="type"){e[s]=n;continue}if(typeof i=="string"&&typeof n=="string")i+=n;else if(typeof i=="number"&&typeof n=="number")i+=n;else if(li(i)&&li(n))i=this.accumulateDelta(i,n);else if(Array.isArray(i)&&Array.isArray(n)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...n);continue}for(const a of n){if(!li(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const c=i[o];c==null?i.push(a):i[o]=this.accumulateDelta(c,a)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${i}`);e[s]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n,i){return await this._createToolAssistantStream(s,e,t,n,i)}}zr=function(e){if(!this.ended)switch(xe(this,un,e,"f"),A(this,ue,"m",Oo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":A(this,ue,"m",To).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,ue,"m",Eo).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":A(this,ue,"m",So).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Vr=function(){if(this.ended)throw new B("stream has ended, this shouldn't happen");if(!A(this,Dt,"f"))throw Error("Final run has not been received");return A(this,Dt,"f")},So=function(e){const[t,s]=A(this,ue,"m",Ao).call(this,e,A(this,Ne,"f"));xe(this,Ne,t,"f"),A(this,ln,"f")[t.id]=t;for(const n of s){const i=t.content[n.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const n of e.data.delta.content){if(n.type=="text"&&n.text){let i=n.text,a=t.content[n.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=A(this,cr,"f")){if(A(this,Lt,"f"))switch(A(this,Lt,"f").type){case"text":this._emit("textDone",A(this,Lt,"f").text,A(this,Ne,"f"));break;case"image_file":this._emit("imageFileDone",A(this,Lt,"f").image_file,A(this,Ne,"f"));break}xe(this,cr,n.index,"f")}xe(this,Lt,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(A(this,cr,"f")!==void 0){const n=e.data.content[A(this,cr,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,A(this,Ne,"f"));break;case"text":this._emit("textDone",n.text,A(this,Ne,"f"));break}}A(this,Ne,"f")&&this._emit("messageDone",e.data),xe(this,Ne,void 0,"f")}},Eo=function(e){const t=A(this,ue,"m",Po).call(this,e);switch(xe(this,Yr,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of s.step_details.tool_calls)i.index==A(this,vn,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(A(this,Ee,"f")&&this._emit("toolCallDone",A(this,Ee,"f")),xe(this,vn,i.index,"f"),xe(this,Ee,t.step_details.tool_calls[i.index],"f"),A(this,Ee,"f")&&this._emit("toolCallCreated",A(this,Ee,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":xe(this,Yr,void 0,"f"),e.data.step_details.type=="tool_calls"&&A(this,Ee,"f")&&(this._emit("toolCallDone",A(this,Ee,"f")),xe(this,Ee,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Oo=function(e){A(this,Zi,"f").push(e),this._emit("event",e)},Po=function(e){switch(e.event){case"thread.run.step.created":return A(this,Ke,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=A(this,Ke,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const n=Be.accumulateDelta(t,s.delta);A(this,Ke,"f")[e.data.id]=n}return A(this,Ke,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":A(this,Ke,"f")[e.data.id]=e.data;break}if(A(this,Ke,"f")[e.data.id])return A(this,Ke,"f")[e.data.id];throw new Error("No snapshot available")},Ao=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const i of n.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=A(this,ue,"m",Co).call(this,i,a)}else t.content[i.index]=i,s.push(i);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Co=function(e,t){return Be.accumulateDelta(t,e)},To=function(e){switch(xe(this,dn,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":xe(this,Dt,e.data,"f"),A(this,Ee,"f")&&(this._emit("toolCallDone",A(this,Ee,"f")),xe(this,Ee,void 0,"f"));break}};class ha extends W{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},s){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,fa,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class fa extends He{}ha.MessagesPage=fa;class ma extends W{retrieve(e,t,s,n={},i){return ke(n)?this.retrieve(e,t,s,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:n,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,s={},n){return ke(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,pa,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class pa extends He{}ma.RunStepsPage=pa;class Ns extends W{constructor(){super(...arguments),this.steps=new ma(this._client)}create(e,t,s){const{include:n,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},s){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ga,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}createAndStream(e,t,s){return Be.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const n={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...s,headers:{...s==null?void 0:s.headers,...n}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await $s(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,s){return Be.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,n){const i=await this.submitToolOutputs(e,t,s,n);return await this.poll(e,i.id,n)}submitToolOutputsStream(e,t,s,n){return Be.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,n)}}class ga extends He{}Ns.RunsPage=ga;Ns.Steps=ma;Ns.RunStepsPage=pa;class Rr extends W{constructor(){super(...arguments),this.runs=new Ns(this._client),this.messages=new ha(this._client)}create(e={},t){return ke(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return Be.createThreadAssistantStream(e,this._client.beta.threads,t)}}Rr.Runs=Ns;Rr.RunsPage=ga;Rr.Messages=ha;Rr.MessagesPage=fa;const ip=async r=>{const e=await Promise.allSettled(r),t=e.filter(n=>n.status==="rejected");if(t.length){for(const n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const s=[];for(const n of e)n.status==="fulfilled"&&s.push(n.value);return s};let ya=class extends W{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},s){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Fn,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){const n={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...s,headers:n}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=i.response.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await $s(o);break;case"failed":case"completed":return a}}}async upload(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){const n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}};class Fn extends He{}ya.VectorStoreFilesPage=Fn;class iu extends W{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s={},n){return ke(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Fn,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async poll(e,t,s){const n={...s==null?void 0:s.headers,"X-Stainless-Poll-Helper":"true"};for(s!=null&&s.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...s,headers:n}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(s!=null&&s.pollIntervalMs)o=s.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const l=parseInt(c);isNaN(l)||(o=l)}}await $s(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(n==null?void 0:n.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,c=t.values(),l=[...s];async function u(h){for(let m of h){const g=await o.files.create({file:m,purpose:"assistants"},n);l.push(g.id)}}const d=Array(a).fill(c).map(u);return await ip(d),await this.createAndPoll(e,{file_ids:l})}}class $r extends W{constructor(){super(...arguments),this.files=new ya(this._client),this.fileBatches=new iu(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/vector_stores",_a,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class _a extends He{}$r.VectorStoresPage=_a;$r.Files=ya;$r.VectorStoreFilesPage=Fn;$r.FileBatches=iu;class Gt extends W{constructor(){super(...arguments),this.vectorStores=new $r(this._client),this.chat=new Bi(this._client),this.assistants=new la(this._client),this.threads=new Rr(this._client)}}Gt.VectorStores=$r;Gt.VectorStoresPage=_a;Gt.Assistants=la;Gt.AssistantsPage=ua;Gt.Threads=Rr;class au extends W{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class ou extends W{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class va extends W{create(e,t){return this._client.post("/files",xr({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/files",ba,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=30*60*1e3}={}){const n=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await $s(t),a=await this.retrieve(e),Date.now()-i>s)throw new ia({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class ba extends He{}va.FileObjectsPage=ba;class wa extends W{list(e,t={},s){return ke(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ka,{query:t,...s})}}class ka extends He{}wa.FineTuningJobCheckpointsPage=ka;class jr extends W{constructor(){super(...arguments),this.checkpoints=new wa(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ke(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",xa,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return ke(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Sa,{query:t,...s})}}class xa extends He{}class Sa extends He{}jr.FineTuningJobsPage=xa;jr.FineTuningJobEventsPage=Sa;jr.Checkpoints=wa;jr.FineTuningJobCheckpointsPage=ka;class Ms extends W{constructor(){super(...arguments),this.jobs=new jr(this._client)}}Ms.Jobs=jr;Ms.FineTuningJobsPage=xa;Ms.FineTuningJobEventsPage=Sa;class cu extends W{createVariation(e,t){return this._client.post("/images/variations",xr({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",xr({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class Ea extends W{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Oa,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Oa extends Hm{}Ea.ModelsPage=Oa;class lu extends W{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class uu extends W{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,xr({body:t,...s}))}}class Pa extends W{constructor(){super(...arguments),this.parts=new uu(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}Pa.Parts=uu;var du;class z extends jm{constructor({baseURL:e=Hs("OPENAI_BASE_URL"),apiKey:t=Hs("OPENAI_API_KEY"),organization:s=Hs("OPENAI_ORG_ID")??null,project:n=Hs("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new B("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:s,project:n,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&zm())throw new B(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new au(this),this.chat=new aa(this),this.embeddings=new ou(this),this.files=new va(this),this.images=new cu(this),this.audio=new js(this),this.moderations=new lu(this),this.models=new Ea(this),this.fineTuning=new Ms(this),this.beta=new Gt(this),this.batches=new oa(this),this.uploads=new Pa(this),this._options=a,this.apiKey=t,this.organization=s,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return gm(e,{arrayFormat:"brackets"})}}du=z;z.OpenAI=du;z.DEFAULT_TIMEOUT=6e5;z.OpenAIError=B;z.APIError=de;z.APIConnectionError=Ln;z.APIConnectionTimeoutError=ia;z.APIUserAbortError=Fe;z.NotFoundError=yl;z.ConflictError=_l;z.RateLimitError=bl;z.BadRequestError=ml;z.AuthenticationError=pl;z.InternalServerError=wl;z.PermissionDeniedError=gl;z.UnprocessableEntityError=vl;z.toFile=Pl;z.fileFromPath=hl;z.Completions=au;z.Chat=aa;z.Embeddings=ou;z.Files=va;z.FileObjectsPage=ba;z.Images=cu;z.Audio=js;z.Moderations=lu;z.Models=Ea;z.ModelsPage=Oa;z.FineTuning=Ms;z.Beta=Gt;z.Batches=oa;z.BatchesPage=ca;z.Uploads=Pa;const ap=Symbol("Let zodToJsonSchema decide on which parser to use"),Ro={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},op=r=>typeof r=="string"?{...Ro,basePath:["#"],definitions:{},name:r}:{...Ro,basePath:["#"],definitions:{},...r},qi=r=>"_def"in r?r._def:r;function cp(r){if(!r)return!0;for(const e in r)return!1;return!0}const lp=r=>{const e=op(r),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([s,n])=>[qi(n),{def:qi(n),path:[...e.basePath,e.definitionPath,s],jsonSchema:void 0}]))}};function hu(r,e,t,s){s!=null&&s.errorMessages&&t&&(r.errorMessage={...r.errorMessage,[e]:t})}function H(r,e,t,s,n){r[e]=t,hu(r,e,s,n)}var q;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const i={};for(const a of n)i[a]=a;return i},r.getValidEnumValues=n=>{const i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(const o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(const a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(q||(q={}));var zi;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(zi||(zi={}));const E=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),vt=r=>{switch(typeof r){case"undefined":return E.undefined;case"string":return E.string;case"number":return isNaN(r)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":return Array.isArray(r)?E.array:r===null?E.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?E.promise:typeof Map<"u"&&r instanceof Map?E.map:typeof Set<"u"&&r instanceof Set?E.set:typeof Date<"u"&&r instanceof Date?E.date:E.object;default:return E.unknown}},b=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),up=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class Oe extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),s}static assert(e){if(!(e instanceof Oe))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}Oe.create=r=>new Oe(r);const Sr=(r,e)=>{let t;switch(r.code){case b.invalid_type:r.received===E.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case b.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,q.jsonStringifyReplacer)}`;break;case b.unrecognized_keys:t=`Unrecognized key(s) in object: ${q.joinValues(r.keys,", ")}`;break;case b.invalid_union:t="Invalid input";break;case b.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${q.joinValues(r.options)}`;break;case b.invalid_enum_value:t=`Invalid enum value. Expected ${q.joinValues(r.options)}, received '${r.received}'`;break;case b.invalid_arguments:t="Invalid function arguments";break;case b.invalid_return_type:t="Invalid function return type";break;case b.invalid_date:t="Invalid date";break;case b.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:q.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case b.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case b.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case b.custom:t="Invalid input";break;case b.invalid_intersection_types:t="Intersection results could not be merged";break;case b.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case b.not_finite:t="Number must be finite";break;default:t=e.defaultError,q.assertNever(r)}return{message:t}};let fu=Sr;function dp(r){fu=r}function bn(){return fu}const wn=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=s.filter(l=>!!l).slice().reverse();for(const l of c)o=l(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},hp=[];function S(r,e){const t=bn(),s=wn({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Sr?void 0:Sr].filter(n=>!!n)});r.common.issues.push(s)}class fe{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return $;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t){const i=await n.key,a=await n.value;s.push({key:i,value:a})}return fe.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return $;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}}const $=Object.freeze({status:"aborted"}),lr=r=>({status:"dirty",value:r}),ge=r=>({status:"valid",value:r}),Vi=r=>r.status==="aborted",Hi=r=>r.status==="dirty",as=r=>r.status==="valid",os=r=>typeof Promise<"u"&&r instanceof Promise;function kn(r,e,t,s){if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function mu(r,e,t,s,n){if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}var P;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(P||(P={}));var Hr,Wr;class et{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const $o=(r,e)=>{if(as(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Oe(r.common.issues);return this._error=t,this._error}}};function N(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{var c,l;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??s)!==null&&c!==void 0?c:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:o.defaultError}},description:n}}class L{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return vt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:vt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new fe,ctx:{common:e.parent.common,data:e.data,parsedType:vt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(os(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:vt(e)},i=this._parseSync({data:e,path:n.path,parent:n});return $o(n,i)}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:vt(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(os(n)?n:Promise.resolve(n));return $o(s,i)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{const a=e(n),o=()=>i.addIssue({code:b.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new Ve({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Ye.create(this,this._def)}nullable(){return Tt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ze.create(this,this._def)}promise(){return Or.create(this,this._def)}or(e){return ds.create([this,e],this._def)}and(e){return hs.create(this,e,this._def)}transform(e){return new Ve({...N(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new ys({...N(this._def),innerType:this,defaultValue:t,typeName:w.ZodDefault})}brand(){return new Aa({typeName:w.ZodBranded,type:this,...N(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new _s({...N(this._def),innerType:this,catchValue:t,typeName:w.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ls.create(this,e)}readonly(){return vs.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const fp=/^c[^\s-]{8,}$/i,mp=/^[0-9a-z]+$/,pp=/^[0-9A-HJKMNP-TV-Z]{26}$/,gp=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yp=/^[a-z0-9_-]{21}$/i,_p=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,vp=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bp="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let pi;const wp=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,kp=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,xp=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,pu="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Sp=new RegExp(`^${pu}$`);function gu(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Ep(r){return new RegExp(`^${gu(r)}$`)}function yu(r){let e=`${pu}T${gu(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Op(r,e){return!!((e==="v4"||!e)&&wp.test(r)||(e==="v6"||!e)&&kp.test(r))}class Ze extends L{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==E.string){const i=this._getOrReturnCtx(e);return S(i,{code:b.invalid_type,expected:E.string,received:i.parsedType}),$}const s=new fe;let n;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?S(n,{code:b.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&S(n,{code:b.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")vp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"email",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")pi||(pi=new RegExp(bp,"u")),pi.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"emoji",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")gp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"uuid",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")yp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"nanoid",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")fp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"cuid",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")mp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"cuid2",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")pp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"ulid",code:b.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),S(n,{validation:"url",code:b.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"regex",code:b.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?yu(i).test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Sp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Ep(i).test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{code:b.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?_p.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"duration",code:b.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Op(e.data,i.version)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"ip",code:b.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?xp.test(e.data)||(n=this._getOrReturnCtx(e,n),S(n,{validation:"base64",code:b.invalid_string,message:i.message}),s.dirty()):q.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:b.invalid_string,...P.errToObj(s)})}_addCheck(e){return new Ze({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...P.errToObj(e)})}url(e){return this._addCheck({kind:"url",...P.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...P.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...P.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...P.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...P.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...P.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...P.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...P.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...P.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...P.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...P.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...P.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...P.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...P.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...P.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...P.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...P.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...P.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...P.errToObj(t)})}nonempty(e){return this.min(1,P.errToObj(e))}trim(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ze({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ze.create=r=>{var e;return new Ze({checks:[],typeName:w.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...N(r)})};function Pp(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=parseInt(r.toFixed(n).replace(".","")),a=parseInt(e.toFixed(n).replace(".",""));return i%a/Math.pow(10,n)}class Pt extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==E.number){const i=this._getOrReturnCtx(e);return S(i,{code:b.invalid_type,expected:E.number,received:i.parsedType}),$}let s;const n=new fe;for(const i of this._def.checks)i.kind==="int"?q.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),S(s,{code:b.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?Pp(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),S(s,{code:b.not_finite,message:i.message}),n.dirty()):q.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,P.toString(t))}gt(e,t){return this.setLimit("min",e,!1,P.toString(t))}lte(e,t){return this.setLimit("max",e,!0,P.toString(t))}lt(e,t){return this.setLimit("max",e,!1,P.toString(t))}setLimit(e,t,s,n){return new Pt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:P.toString(n)}]})}_addCheck(e){return new Pt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:P.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:P.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:P.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:P.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:P.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:P.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:P.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:P.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:P.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Pt.create=r=>new Pt({checks:[],typeName:w.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...N(r)});class At extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==E.bigint){const i=this._getOrReturnCtx(e);return S(i,{code:b.invalid_type,expected:E.bigint,received:i.parsedType}),$}let s;const n=new fe;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),S(s,{code:b.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):q.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,P.toString(t))}gt(e,t){return this.setLimit("min",e,!1,P.toString(t))}lte(e,t){return this.setLimit("max",e,!0,P.toString(t))}lt(e,t){return this.setLimit("max",e,!1,P.toString(t))}setLimit(e,t,s,n){return new At({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:P.toString(n)}]})}_addCheck(e){return new At({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:P.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:P.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:P.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:P.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:P.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}At.create=r=>{var e;return new At({checks:[],typeName:w.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...N(r)})};class cs extends L{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==E.boolean){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.boolean,received:s.parsedType}),$}return ge(e.data)}}cs.create=r=>new cs({typeName:w.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...N(r)});class Ht extends L{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==E.date){const i=this._getOrReturnCtx(e);return S(i,{code:b.invalid_type,expected:E.date,received:i.parsedType}),$}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return S(i,{code:b.invalid_date}),$}const s=new fe;let n;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),S(n,{code:b.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):q.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ht({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:P.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:P.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Ht.create=r=>new Ht({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:w.ZodDate,...N(r)});class xn extends L{_parse(e){if(this._getType(e)!==E.symbol){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.symbol,received:s.parsedType}),$}return ge(e.data)}}xn.create=r=>new xn({typeName:w.ZodSymbol,...N(r)});class ls extends L{_parse(e){if(this._getType(e)!==E.undefined){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.undefined,received:s.parsedType}),$}return ge(e.data)}}ls.create=r=>new ls({typeName:w.ZodUndefined,...N(r)});class us extends L{_parse(e){if(this._getType(e)!==E.null){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.null,received:s.parsedType}),$}return ge(e.data)}}us.create=r=>new us({typeName:w.ZodNull,...N(r)});class Er extends L{constructor(){super(...arguments),this._any=!0}_parse(e){return ge(e.data)}}Er.create=r=>new Er({typeName:w.ZodAny,...N(r)});class zt extends L{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ge(e.data)}}zt.create=r=>new zt({typeName:w.ZodUnknown,...N(r)});class ht extends L{_parse(e){const t=this._getOrReturnCtx(e);return S(t,{code:b.invalid_type,expected:E.never,received:t.parsedType}),$}}ht.create=r=>new ht({typeName:w.ZodNever,...N(r)});class Sn extends L{_parse(e){if(this._getType(e)!==E.undefined){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.void,received:s.parsedType}),$}return ge(e.data)}}Sn.create=r=>new Sn({typeName:w.ZodVoid,...N(r)});class ze extends L{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==E.array)return S(t,{code:b.invalid_type,expected:E.array,received:t.parsedType}),$;if(n.exactLength!==null){const a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(S(t,{code:a?b.too_big:b.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(S(t,{code:b.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(S(t,{code:b.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new et(t,a,t.path,o)))).then(a=>fe.mergeArray(s,a));const i=[...t.data].map((a,o)=>n.type._parseSync(new et(t,a,t.path,o)));return fe.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new ze({...this._def,minLength:{value:e,message:P.toString(t)}})}max(e,t){return new ze({...this._def,maxLength:{value:e,message:P.toString(t)}})}length(e,t){return new ze({...this._def,exactLength:{value:e,message:P.toString(t)}})}nonempty(e){return this.min(1,e)}}ze.create=(r,e)=>new ze({type:r,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...N(e)});function or(r){if(r instanceof ee){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=Ye.create(or(s))}return new ee({...r._def,shape:()=>e})}else return r instanceof ze?new ze({...r._def,type:or(r.element)}):r instanceof Ye?Ye.create(or(r.unwrap())):r instanceof Tt?Tt.create(or(r.unwrap())):r instanceof tt?tt.create(r.items.map(e=>or(e))):r}class ee extends L{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=q.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==E.object){const l=this._getOrReturnCtx(e);return S(l,{code:b.invalid_type,expected:E.object,received:l.parsedType}),$}const{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(const l in n.data)a.includes(l)||o.push(l);const c=[];for(const l of a){const u=i[l],d=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new et(n,d,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof ht){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(l==="strict")o.length>0&&(S(n,{code:b.unrecognized_keys,keys:o}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const d=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new et(n,d,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const d=await u.key,h=await u.value;l.push({key:d,value:h,alwaysSet:u.alwaysSet})}return l}).then(l=>fe.mergeObjectSync(s,l)):fe.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return P.errToObj,new ee({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,i,a,o;const c=(a=(i=(n=this._def).errorMap)===null||i===void 0?void 0:i.call(n,t,s).message)!==null&&a!==void 0?a:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=P.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new ee({...this._def,unknownKeys:"strip"})}passthrough(){return new ee({...this._def,unknownKeys:"passthrough"})}extend(e){return new ee({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ee({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ee({...this._def,catchall:e})}pick(e){const t={};return q.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new ee({...this._def,shape:()=>t})}omit(e){const t={};return q.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new ee({...this._def,shape:()=>t})}deepPartial(){return or(this)}partial(e){const t={};return q.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new ee({...this._def,shape:()=>t})}required(e){const t={};return q.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Ye;)i=i._def.innerType;t[s]=i}}),new ee({...this._def,shape:()=>t})}keyof(){return _u(q.objectKeys(this.shape))}}ee.create=(r,e)=>new ee({shape:()=>r,unknownKeys:"strip",catchall:ht.create(),typeName:w.ZodObject,...N(e)});ee.strictCreate=(r,e)=>new ee({shape:()=>r,unknownKeys:"strict",catchall:ht.create(),typeName:w.ZodObject,...N(e)});ee.lazycreate=(r,e)=>new ee({shape:r,unknownKeys:"strip",catchall:ht.create(),typeName:w.ZodObject,...N(e)});class ds extends L{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Oe(o.ctx.common.issues));return S(t,{code:b.invalid_union,unionErrors:a}),$}if(t.common.async)return Promise.all(s.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i;const a=[];for(const c of s){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(c=>new Oe(c));return S(t,{code:b.invalid_union,unionErrors:o}),$}}get options(){return this._def.options}}ds.create=(r,e)=>new ds({options:r,typeName:w.ZodUnion,...N(e)});const nt=r=>r instanceof ms?nt(r.schema):r instanceof Ve?nt(r.innerType()):r instanceof ps?[r.value]:r instanceof Ct?r.options:r instanceof gs?q.objectValues(r.enum):r instanceof ys?nt(r._def.innerType):r instanceof ls?[void 0]:r instanceof us?[null]:r instanceof Ye?[void 0,...nt(r.unwrap())]:r instanceof Tt?[null,...nt(r.unwrap())]:r instanceof Aa||r instanceof vs?nt(r.unwrap()):r instanceof _s?nt(r._def.innerType):[];class Bn extends L{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.object)return S(t,{code:b.invalid_type,expected:E.object,received:t.parsedType}),$;const s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(S(t,{code:b.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),$)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const i of t){const a=nt(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new Bn({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...N(s)})}}function Wi(r,e){const t=vt(r),s=vt(e);if(r===e)return{valid:!0,data:r};if(t===E.object&&s===E.object){const n=q.objectKeys(e),i=q.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(const o of i){const c=Wi(r[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===E.array&&s===E.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],c=Wi(a,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===E.date&&s===E.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class hs extends L{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(Vi(i)||Vi(a))return $;const o=Wi(i.value,a.value);return o.valid?((Hi(i)||Hi(a))&&t.dirty(),{status:t.value,value:o.data}):(S(s,{code:b.invalid_intersection_types}),$)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}hs.create=(r,e,t)=>new hs({left:r,right:e,typeName:w.ZodIntersection,...N(t)});class tt extends L{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==E.array)return S(s,{code:b.invalid_type,expected:E.array,received:s.parsedType}),$;if(s.data.length<this._def.items.length)return S(s,{code:b.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$;!this._def.rest&&s.data.length>this._def.items.length&&(S(s,{code:b.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((a,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new et(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>fe.mergeArray(t,a)):fe.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new tt({...this._def,rest:e})}}tt.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new tt({items:r,typeName:w.ZodTuple,rest:null,...N(e)})};class fs extends L{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==E.object)return S(s,{code:b.invalid_type,expected:E.object,received:s.parsedType}),$;const n=[],i=this._def.keyType,a=this._def.valueType;for(const o in s.data)n.push({key:i._parse(new et(s,o,s.path,o)),value:a._parse(new et(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?fe.mergeObjectAsync(t,n):fe.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof L?new fs({keyType:e,valueType:t,typeName:w.ZodRecord,...N(s)}):new fs({keyType:Ze.create(),valueType:e,typeName:w.ZodRecord,...N(t)})}}class En extends L{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==E.map)return S(s,{code:b.invalid_type,expected:E.map,received:s.parsedType}),$;const n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,c],l)=>({key:n._parse(new et(s,o,s.path,[l,"key"])),value:i._parse(new et(s,c,s.path,[l,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of a){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return $;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of a){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return $;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}En.create=(r,e,t)=>new En({valueType:e,keyType:r,typeName:w.ZodMap,...N(t)});class Wt extends L{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==E.set)return S(s,{code:b.invalid_type,expected:E.set,received:s.parsedType}),$;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(S(s,{code:b.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(S(s,{code:b.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const i=this._def.valueType;function a(c){const l=new Set;for(const u of c){if(u.status==="aborted")return $;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...s.data.values()].map((c,l)=>i._parse(new et(s,c,s.path,l)));return s.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new Wt({...this._def,minSize:{value:e,message:P.toString(t)}})}max(e,t){return new Wt({...this._def,maxSize:{value:e,message:P.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Wt.create=(r,e)=>new Wt({valueType:r,minSize:null,maxSize:null,typeName:w.ZodSet,...N(e)});class pr extends L{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.function)return S(t,{code:b.invalid_type,expected:E.function,received:t.parsedType}),$;function s(o,c){return wn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,bn(),Sr].filter(l=>!!l),issueData:{code:b.invalid_arguments,argumentsError:c}})}function n(o,c){return wn({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,bn(),Sr].filter(l=>!!l),issueData:{code:b.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Or){const o=this;return ge(async function(...c){const l=new Oe([]),u=await o._def.args.parseAsync(c,i).catch(m=>{throw l.addIssue(s(c,m)),l}),d=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(d,i).catch(m=>{throw l.addIssue(n(d,m)),l})})}else{const o=this;return ge(function(...c){const l=o._def.args.safeParse(c,i);if(!l.success)throw new Oe([s(c,l.error)]);const u=Reflect.apply(a,this,l.data),d=o._def.returns.safeParse(u,i);if(!d.success)throw new Oe([n(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new pr({...this._def,args:tt.create(e).rest(zt.create())})}returns(e){return new pr({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new pr({args:e||tt.create([]).rest(zt.create()),returns:t||zt.create(),typeName:w.ZodFunction,...N(s)})}}class ms extends L{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ms.create=(r,e)=>new ms({getter:r,typeName:w.ZodLazy,...N(e)});class ps extends L{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return S(t,{received:t.data,code:b.invalid_literal,expected:this._def.value}),$}return{status:"valid",value:e.data}}get value(){return this._def.value}}ps.create=(r,e)=>new ps({value:r,typeName:w.ZodLiteral,...N(e)});function _u(r,e){return new Ct({values:r,typeName:w.ZodEnum,...N(e)})}class Ct extends L{constructor(){super(...arguments),Hr.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return S(t,{expected:q.joinValues(s),received:t.parsedType,code:b.invalid_type}),$}if(kn(this,Hr)||mu(this,Hr,new Set(this._def.values)),!kn(this,Hr).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return S(t,{received:t.data,code:b.invalid_enum_value,options:s}),$}return ge(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Ct.create(e,{...this._def,...t})}exclude(e,t=this._def){return Ct.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}Hr=new WeakMap;Ct.create=_u;class gs extends L{constructor(){super(...arguments),Wr.set(this,void 0)}_parse(e){const t=q.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==E.string&&s.parsedType!==E.number){const n=q.objectValues(t);return S(s,{expected:q.joinValues(n),received:s.parsedType,code:b.invalid_type}),$}if(kn(this,Wr)||mu(this,Wr,new Set(q.getValidEnumValues(this._def.values))),!kn(this,Wr).has(e.data)){const n=q.objectValues(t);return S(s,{received:s.data,code:b.invalid_enum_value,options:n}),$}return ge(e.data)}get enum(){return this._def.values}}Wr=new WeakMap;gs.create=(r,e)=>new gs({values:r,typeName:w.ZodNativeEnum,...N(e)});class Or extends L{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.promise&&t.common.async===!1)return S(t,{code:b.invalid_type,expected:E.promise,received:t.parsedType}),$;const s=t.parsedType===E.promise?t.data:Promise.resolve(t.data);return ge(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Or.create=(r,e)=>new Or({type:r,typeName:w.ZodPromise,...N(e)});class Ve extends L{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{S(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return $;const c=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return c.status==="aborted"?$:c.status==="dirty"||t.value==="dirty"?lr(c.value):c});{if(t.value==="aborted")return $;const o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?$:o.status==="dirty"||t.value==="dirty"?lr(o.value):o}}if(n.type==="refinement"){const a=o=>{const c=n.refinement(o,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?$:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?$:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!as(a))return a;const o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>as(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);q.assertNever(n)}}Ve.create=(r,e,t)=>new Ve({schema:r,typeName:w.ZodEffects,effect:e,...N(t)});Ve.createWithPreprocess=(r,e,t)=>new Ve({schema:e,effect:{type:"preprocess",transform:r},typeName:w.ZodEffects,...N(t)});class Ye extends L{_parse(e){return this._getType(e)===E.undefined?ge(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ye.create=(r,e)=>new Ye({innerType:r,typeName:w.ZodOptional,...N(e)});class Tt extends L{_parse(e){return this._getType(e)===E.null?ge(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Tt.create=(r,e)=>new Tt({innerType:r,typeName:w.ZodNullable,...N(e)});class ys extends L{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===E.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ys.create=(r,e)=>new ys({innerType:r,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...N(e)});class _s extends L{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return os(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Oe(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Oe(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}_s.create=(r,e)=>new _s({innerType:r,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...N(e)});class On extends L{_parse(e){if(this._getType(e)!==E.nan){const s=this._getOrReturnCtx(e);return S(s,{code:b.invalid_type,expected:E.nan,received:s.parsedType}),$}return{status:"valid",value:e.data}}}On.create=r=>new On({typeName:w.ZodNaN,...N(r)});const Ap=Symbol("zod_brand");class Aa extends L{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ls extends L{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?$:i.status==="dirty"?(t.dirty(),lr(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?$:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new Ls({in:e,out:t,typeName:w.ZodPipeline})}}class vs extends L{_parse(e){const t=this._def.innerType._parse(e),s=n=>(as(n)&&(n.value=Object.freeze(n.value)),n);return os(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}}vs.create=(r,e)=>new vs({innerType:r,typeName:w.ZodReadonly,...N(e)});function vu(r,e={},t){return r?Er.create().superRefine((s,n)=>{var i,a;if(!r(s)){const o=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,c=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;n.addIssue({code:"custom",...l,fatal:c})}}):Er.create()}const Cp={object:ee.lazycreate};var w;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(w||(w={}));const Tp=(r,e={message:`Input not instance of ${r.name}`})=>vu(t=>t instanceof r,e),bu=Ze.create,wu=Pt.create,Rp=On.create,$p=At.create,ku=cs.create,jp=Ht.create,Ip=xn.create,Np=ls.create,Mp=us.create,Lp=Er.create,Dp=zt.create,Up=ht.create,Fp=Sn.create,Bp=ze.create,Zp=ee.create,qp=ee.strictCreate,zp=ds.create,Vp=Bn.create,Hp=hs.create,Wp=tt.create,Jp=fs.create,Kp=En.create,Gp=Wt.create,Xp=pr.create,Qp=ms.create,Yp=ps.create,eg=Ct.create,tg=gs.create,rg=Or.create,jo=Ve.create,sg=Ye.create,ng=Tt.create,ig=Ve.createWithPreprocess,ag=Ls.create,og=()=>bu().optional(),cg=()=>wu().optional(),lg=()=>ku().optional(),ug={string:r=>Ze.create({...r,coerce:!0}),number:r=>Pt.create({...r,coerce:!0}),boolean:r=>cs.create({...r,coerce:!0}),bigint:r=>At.create({...r,coerce:!0}),date:r=>Ht.create({...r,coerce:!0})},dg=$;var I=Object.freeze({__proto__:null,defaultErrorMap:Sr,setErrorMap:dp,getErrorMap:bn,makeIssue:wn,EMPTY_PATH:hp,addIssueToContext:S,ParseStatus:fe,INVALID:$,DIRTY:lr,OK:ge,isAborted:Vi,isDirty:Hi,isValid:as,isAsync:os,get util(){return q},get objectUtil(){return zi},ZodParsedType:E,getParsedType:vt,ZodType:L,datetimeRegex:yu,ZodString:Ze,ZodNumber:Pt,ZodBigInt:At,ZodBoolean:cs,ZodDate:Ht,ZodSymbol:xn,ZodUndefined:ls,ZodNull:us,ZodAny:Er,ZodUnknown:zt,ZodNever:ht,ZodVoid:Sn,ZodArray:ze,ZodObject:ee,ZodUnion:ds,ZodDiscriminatedUnion:Bn,ZodIntersection:hs,ZodTuple:tt,ZodRecord:fs,ZodMap:En,ZodSet:Wt,ZodFunction:pr,ZodLazy:ms,ZodLiteral:ps,ZodEnum:Ct,ZodNativeEnum:gs,ZodPromise:Or,ZodEffects:Ve,ZodTransformer:Ve,ZodOptional:Ye,ZodNullable:Tt,ZodDefault:ys,ZodCatch:_s,ZodNaN:On,BRAND:Ap,ZodBranded:Aa,ZodPipeline:Ls,ZodReadonly:vs,custom:vu,Schema:L,ZodSchema:L,late:Cp,get ZodFirstPartyTypeKind(){return w},coerce:ug,any:Lp,array:Bp,bigint:$p,boolean:ku,date:jp,discriminatedUnion:Vp,effect:jo,enum:eg,function:Xp,instanceof:Tp,intersection:Hp,lazy:Qp,literal:Yp,map:Kp,nan:Rp,nativeEnum:tg,never:Up,null:Mp,nullable:ng,number:wu,object:Zp,oboolean:lg,onumber:cg,optional:sg,ostring:og,pipeline:ag,preprocess:ig,promise:rg,record:Jp,set:Gp,strictObject:qp,string:bu,symbol:Ip,transformer:jo,tuple:Wp,undefined:Np,union:zp,unknown:Dp,void:Fp,NEVER:dg,ZodIssueCode:b,quotelessJson:up,ZodError:Oe});function hg(){return{}}function fg(r,e){var s,n;const t={type:"array"};return((n=(s=r.type)==null?void 0:s._def)==null?void 0:n.typeName)!==w.ZodAny&&(t.items=V(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&H(t,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&H(t,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(H(t,"minItems",r.exactLength.value,r.exactLength.message,e),H(t,"maxItems",r.exactLength.value,r.exactLength.message,e)),t}function mg(r,e){const t={type:"integer",format:"int64"};if(!r.checks)return t;for(const s of r.checks)switch(s.kind){case"min":e.target==="jsonSchema7"?s.inclusive?H(t,"minimum",s.value,s.message,e):H(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),H(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?H(t,"maximum",s.value,s.message,e):H(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),H(t,"maximum",s.value,s.message,e));break;case"multipleOf":H(t,"multipleOf",s.value,s.message,e);break}return t}function pg(){return{type:"boolean"}}function gg(r,e){return V(r.type._def,e)}const yg=(r,e)=>V(r.innerType._def,e);function xu(r,e,t){const s=t??e.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((n,i)=>xu(r,e,n))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return _g(r,e)}}const _g=(r,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const s of r.checks)switch(s.kind){case"min":H(t,"minimum",s.value,s.message,e);break;case"max":H(t,"maximum",s.value,s.message,e);break}return t};function vg(r,e){return{...V(r.innerType._def,e),default:r.defaultValue()}}function bg(r,e,t){return e.effectStrategy==="input"?V(r.schema._def,e,t):{}}function wg(r){return{type:"string",enum:[...r.values]}}const kg=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function xg(r,e){const t=[V(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),V(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let s=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return t.forEach(i=>{if(kg(i))n.push(...i.allOf),i.unevaluatedProperties===void 0&&(s=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...c}=i;a=c}else s=void 0;n.push(a)}}),n.length?{allOf:n,...s}:void 0}function Sg(r,e){const t=typeof r.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[r.value]}:{type:t==="bigint"?"integer":t,const:r.value}}let gi;const $t={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gi===void 0&&(gi=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gi),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Su(r,e){const t={type:"string"};function s(n){return e.patternStrategy==="escape"?Eg(n):n}if(r.checks)for(const n of r.checks)switch(n.kind){case"min":H(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":H(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Re(t,"email",n.message,e);break;case"format:idn-email":Re(t,"idn-email",n.message,e);break;case"pattern:zod":$e(t,$t.email,n.message,e);break}break;case"url":Re(t,"uri",n.message,e);break;case"uuid":Re(t,"uuid",n.message,e);break;case"regex":$e(t,n.regex,n.message,e);break;case"cuid":$e(t,$t.cuid,n.message,e);break;case"cuid2":$e(t,$t.cuid2,n.message,e);break;case"startsWith":$e(t,RegExp(`^${s(n.value)}`),n.message,e);break;case"endsWith":$e(t,RegExp(`${s(n.value)}$`),n.message,e);break;case"datetime":Re(t,"date-time",n.message,e);break;case"date":Re(t,"date",n.message,e);break;case"time":Re(t,"time",n.message,e);break;case"duration":Re(t,"duration",n.message,e);break;case"length":H(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),H(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{$e(t,RegExp(s(n.value)),n.message,e);break}case"ip":{n.version!=="v6"&&Re(t,"ipv4",n.message,e),n.version!=="v4"&&Re(t,"ipv6",n.message,e);break}case"emoji":$e(t,$t.emoji,n.message,e);break;case"ulid":{$e(t,$t.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Re(t,"binary",n.message,e);break}case"contentEncoding:base64":{H(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{$e(t,$t.base64,n.message,e);break}}break}case"nanoid":$e(t,$t.nanoid,n.message,e)}return t}const Eg=r=>Array.from(r).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Re=(r,e,t,s)=>{var n;r.format||(n=r.anyOf)!=null&&n.some(i=>i.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&s.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...t&&s.errorMessages&&{errorMessage:{format:t}}})):H(r,"format",e,t,s)},$e=(r,e,t,s)=>{var n;r.pattern||(n=r.allOf)!=null&&n.some(i=>i.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&s.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Io(e,s),...t&&s.errorMessages&&{errorMessage:{pattern:t}}})):H(r,"pattern",Io(e,s),t,s)},Io=(r,e)=>{var l;const t=typeof r=="function"?r():r;if(!e.applyRegexFlags||!t.flags)return t.source;const s={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=s.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,c=!1;for(let u=0;u<n.length;u++){if(a){i+=n[u],a=!1;continue}if(s.i){if(o){if(n[u].match(/[a-z]/)){c?(i+=n[u],i+=`${n[u-2]}-${n[u]}`.toUpperCase(),c=!1):n[u+1]==="-"&&((l=n[u+2])!=null&&l.match(/[a-z]/))?(i+=n[u],c=!0):i+=`${n[u]}${n[u].toUpperCase()}`;continue}}else if(n[u].match(/[a-z]/)){i+=`[${n[u]}${n[u].toUpperCase()}]`;continue}}if(s.m){if(n[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(n[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(s.s&&n[u]==="."){i+=o?`${n[u]}\r
`:`[${n[u]}\r
]`;continue}i+=n[u],n[u]==="\\"?a=!0:o&&n[u]==="]"?o=!1:!o&&n[u]==="["&&(o=!0)}try{const u=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function Eu(r,e){var s,n,i,a;if(e.target==="openApi3"&&((s=r.keyType)==null?void 0:s._def.typeName)===w.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((o,c)=>({...o,[c]:V(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:V(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((n=r.keyType)==null?void 0:n._def.typeName)===w.ZodString&&((i=r.keyType._def.checks)!=null&&i.length)){const o=Object.entries(Su(r.keyType._def,e)).reduce((c,[l,u])=>l==="type"?c:{...c,[l]:u},{});return{...t,propertyNames:o}}else if(((a=r.keyType)==null?void 0:a._def.typeName)===w.ZodEnum)return{...t,propertyNames:{enum:r.keyType._def.values}};return t}function Og(r,e){if(e.mapStrategy==="record")return Eu(r,e);const t=V(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},s=V(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,s],minItems:2,maxItems:2}}}function Pg(r){const e=r.values,s=Object.keys(r.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),n=Array.from(new Set(s.map(i=>typeof i)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:s}}function Ag(){return{not:{}}}function Cg(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Pn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Tg(r,e){if(e.target==="openApi3")return No(r,e);const t=r.options instanceof Map?Array.from(r.options.values()):r.options;if(t.every(s=>s._def.typeName in Pn&&(!s._def.checks||!s._def.checks.length))){const s=t.reduce((n,i)=>{const a=Pn[i._def.typeName];return a&&!n.includes(a)?[...n,a]:n},[]);return{type:s.length>1?s:s[0]}}else if(t.every(s=>s._def.typeName==="ZodLiteral"&&!s.description)){const s=t.reduce((n,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...n,a];case"bigint":return[...n,"integer"];case"object":if(i._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(s.length===t.length){const n=s.filter((i,a,o)=>o.indexOf(i)===a);return{type:n.length>1?n:n[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(s=>s._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((s,n)=>[...s,...n._def.values.filter(i=>!s.includes(i))],[])};return No(r,e)}const No=(r,e)=>{const t=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((s,n)=>V(s._def,{...e,currentPath:[...e.currentPath,"anyOf",`${n}`]})).filter(s=>!!s&&(!e.strictUnions||typeof s=="object"&&Object.keys(s).length>0));return t.length?{anyOf:t}:void 0};function Rg(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Pn[r.innerType._def.typeName],nullable:!0}:{type:[Pn[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const s=V(r.innerType._def,{...e,currentPath:[...e.currentPath]});return s&&"$ref"in s?{allOf:[s],nullable:!0}:s&&{...s,nullable:!0}}const t=V(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function $g(r,e){const t={type:"number"};if(!r.checks)return t;for(const s of r.checks)switch(s.kind){case"int":t.type="integer",hu(t,"type",s.message,e);break;case"min":e.target==="jsonSchema7"?s.inclusive?H(t,"minimum",s.value,s.message,e):H(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),H(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?H(t,"maximum",s.value,s.message,e):H(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),H(t,"maximum",s.value,s.message,e));break;case"multipleOf":H(t,"multipleOf",s.value,s.message,e);break}return t}function jg(r,e){return e.removeAdditionalStrategy==="strict"?r.catchall._def.typeName==="ZodNever"?r.unknownKeys!=="strict":V(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:r.catchall._def.typeName==="ZodNever"?r.unknownKeys==="passthrough":V(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function Ig(r,e){const t={type:"object",...Object.entries(r.shape()).reduce((s,[n,i])=>{if(i===void 0||i._def===void 0)return s;const a=V(i._def,{...e,currentPath:[...e.currentPath,"properties",n],propertyPath:[...e.currentPath,"properties",n]});return a===void 0?s:{properties:{...s.properties,[n]:a},required:i.isOptional()&&!e.openaiStrictMode?s.required:[...s.required,n]}},{properties:{},required:[]}),additionalProperties:jg(r,e)};return t.required.length||delete t.required,t}const Ng=(r,e)=>{var s;if(e.currentPath.toString()===((s=e.propertyPath)==null?void 0:s.toString()))return V(r.innerType._def,e);const t=V(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Mg=(r,e)=>{if(e.pipeStrategy==="input")return V(r.in._def,e);if(e.pipeStrategy==="output")return V(r.out._def,e);const t=V(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),s=V(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,s].filter(n=>n!==void 0)}};function Lg(r,e){return V(r.type._def,e)}function Dg(r,e){const s={type:"array",uniqueItems:!0,items:V(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&H(s,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&H(s,"maxItems",r.maxSize.value,r.maxSize.message,e),s}function Ug(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((t,s)=>V(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[]),additionalItems:V(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((t,s)=>V(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[])}}function Fg(){return{not:{}}}function Bg(){return{}}const Zg=(r,e)=>V(r.innerType._def,e);function V(r,e,t=!1){var a;const s=e.seen.get(r);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,r,e,s,t);if(o!==ap)return o}if(s&&!t){const o=qg(s,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const n={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,n);const i=Vg(r,r.typeName,e,t);return i&&Hg(r,e,i),n.jsonSchema=i,i}const qg=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"extract-to-root":const t=r.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=r.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:zg(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((s,n)=>e.currentPath[n]===s)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},zg=(r,e)=>{let t=0;for(;t<r.length&&t<e.length&&r[t]===e[t];t++);return[(r.length-t).toString(),...e.slice(t)].join("/")},Vg=(r,e,t,s)=>{switch(e){case w.ZodString:return Su(r,t);case w.ZodNumber:return $g(r,t);case w.ZodObject:return Ig(r,t);case w.ZodBigInt:return mg(r,t);case w.ZodBoolean:return pg();case w.ZodDate:return xu(r,t);case w.ZodUndefined:return Fg();case w.ZodNull:return Cg(t);case w.ZodArray:return fg(r,t);case w.ZodUnion:case w.ZodDiscriminatedUnion:return Tg(r,t);case w.ZodIntersection:return xg(r,t);case w.ZodTuple:return Ug(r,t);case w.ZodRecord:return Eu(r,t);case w.ZodLiteral:return Sg(r,t);case w.ZodEnum:return wg(r);case w.ZodNativeEnum:return Pg(r);case w.ZodNullable:return Rg(r,t);case w.ZodOptional:return Ng(r,t);case w.ZodMap:return Og(r,t);case w.ZodSet:return Dg(r,t);case w.ZodLazy:return V(r.getter()._def,t);case w.ZodPromise:return Lg(r,t);case w.ZodNaN:case w.ZodNever:return Ag();case w.ZodEffects:return bg(r,t,s);case w.ZodAny:return hg();case w.ZodUnknown:return Bg();case w.ZodDefault:return vg(r,t);case w.ZodBranded:return gg(r,t);case w.ZodReadonly:return Zg(r,t);case w.ZodCatch:return yg(r,t);case w.ZodPipeline:return Mg(r,t);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(n=>{})()}},Hg=(r,e,t)=>(r.description&&(t.description=r.description,e.markdownDescription&&(t.markdownDescription=r.description)),t),Wg=(r,e)=>{const t=lp(e),s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=V(r._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);const a=(()=>{if(cp(t.definitions))return;const c={},l=new Set;for(let u=0;u<500;u++){const d=Object.entries(t.definitions).filter(([h])=>!l.has(h));if(d.length===0)break;for(const[h,m]of d)c[h]=V(qi(m),{...t,currentPath:[...t.basePath,t.definitionPath,h]},!0)??{},l.add(h)}return c})(),o=s===void 0?a?{...n,[t.definitionPath]:a}:n:t.nameStrategy==="duplicate-ref"?{...n,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[s]:n}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...a,[s]:n}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Jg(r,e){return Wg(r,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Kg(r,e,t){return Wm({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Jg(r,{name:e})}},s=>r.parse(JSON.parse(s)))}const Gg=I.object({shoutengai:I.object({index:I.number(),text:I.string()}),michi:I.object({index:I.number(),text:I.string()}),furuiMise:I.object({index:I.number(),text:I.string()}),shokuSample:I.object({index:I.number(),text:I.string()}),building:I.object({index:I.number(),text:I.string()}),chain:I.object({index:I.number(),text:I.string()})});async function Xg(r,e){const t=`
    ${e}4010
    -  (shoutengai)
    -  (michi)
    -  (furui_mise)
    -  (shoku_sample)
    -  (building)
    -  (chain)

    120

    JSON
    {
      "shoutengai":  { "index": , "text": "" },
      "michi":  { "index": , "text": "" },
      "furuiMise": { "index": , "text": "" },
      "shokuSample": { "index": , "text": "" },
      "building": { "index": , "text": "" },
      "chain": { "index": , "text": "" },
    }`;try{return console.log("openai call"),(await new z({apiKey:r}).beta.chat.completions.parse({model:"gpt-4o-2024-08-06",messages:[{role:"system",content:"JSON"},{role:"user",content:t}],response_format:Kg(Gg,"omuIndex")})).choices[0].message.parsed}catch(s){return console.error("Error generating Omu Index:",s),null}}function Gs(r){return Math.floor(r>10?10:r)}async function Qg(r,e){if(!e)return null;const t=await sm(e);return t==null?null:(console.log(e),console.log(t),await Yg(r,t.station_name,t.station_id,t.lat,t.lng))}async function Yg(r,e,t,s,n){try{let i=0,a=await rl(e,t,s,n);if(a!=null)return a;const o=Xg(r.openaiApiKey,e),c=await am(r.googleApiKey,s,n);if(!c)return null;const l=Gs(c.localCafe.count),u=Gs(c.chineseRestaurant.count),d=Gs(c.westernRestaurant.count),h=Gs(c.snack.count);i=l+u+d+h;const m=await o;if(!m)return null;for(const g of Object.keys(m)){const y=m[g];i+=y.index}return a={index:i,station_id:t,stationName:e,lat:s,lng:n,googlemap:c,openai:m},await em(t,a),a}catch(i){return console.error("Error fetching Omu Index:",i),null}}async function Ou(r,e,t){function s(u){const d=atob(u),h=d.length,m=new Uint8Array(h);for(let g=0;g<h;g++)m[g]=d.charCodeAt(g);return m.buffer}const n=s(e),i=new Blob([n],{type:"image/png"}),a=new FormData;a.append("access_token",r),a.append("imagedata",i,t),console.log("Uploading image to Gyazo...");const o=I.object({url:I.string().url()}),c=await fetch("https://upload.gyazo.com/api/upload",{method:"POST",body:a});if(!c.ok)throw new Error(`Gyazo: ${c.statusText}`);return o.parse(await c.json()).url}const Pe=new Xi;Pe.use(zd);Pe.get("/",r=>r.redirect("/static/topmenu.html"));Pe.get("/newmap",r=>r.render(f("html",{children:[f("script",{type:"text/javascript",src:"https://cdn.jsdelivr.net/npm/simplebar@5.3.6/dist/simplebar.min.js"}),f("link",{href:"/static/newmap.css",rel:"stylesheet"}),f(Cn,{children:[f("div",{id:"map"}),f("div",{class:"content","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:f("div",{id:"omurice-list",children:f("table",{children:[f("thead",{children:f("tr",{children:[f("th",{children:""}),f("th",{children:""})]})}),f("tbody",{id:"station-list"})]})})})]}),f("script",{src:"https://unpkg.com/leaflet/dist/leaflet.js"}),f("script",{src:"https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"}),f("script",{src:"https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"}),f("script",{src:"https://cdn.jsdelivr.net/npm/@supabase/supabase-js"}),f("script",{src:"static/main.js",defer:!0})]})));Pe.get("/omuregist",r=>r.render(f("html",{children:[f("title",{children:""}),f("script",{type:"text/javascript",src:"https://cdn.jsdelivr.net/npm/simplebar@5.3.6/dist/simplebar.min.js"}),f("link",{rel:"stylesheet",href:"static/style.css"}),f("link",{href:"/static/omuregist.css",rel:"stylesheet"}),f(Cn,{children:f("div",{class:"content","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:[f("header",{children:""}),f("main",{children:[f("form",{id:"uploadForm",method:"post",enctype:"multipart/form-data",children:[f("div",{class:"text",children:[f("label",{for:"station",children:":"}),f("input",{type:"text",name:"station",id:"station",required:!0})]}),f("div",{class:"choices",children:[f("p",{children:""}),f("label",{children:[f("input",{type:"radio",name:"egg",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"egg",value:"3"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"egg",value:"1"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"egg",value:"0"}),"  ",f("br",{})]})]}),f("div",{class:"choices",children:[f("p",{children:""}),f("label",{children:[f("input",{type:"radio",name:"rice",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"rice",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"rice",value:"2"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"rice",value:"0"}),"  ",f("br",{})]})]}),f("div",{class:"choices",children:[f("p",{children:""}),f("label",{children:[f("input",{type:"radio",name:"sauce",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"sauce",value:"4"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"sauce",value:"2"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"sauce",value:"0"}),"  ",f("br",{})]})]}),f("div",{class:"file-upload",children:[f("label",{for:"file",children:""}),f("input",{type:"file",id:"file",name:"file",accept:"image/*",required:!0})]}),f("div",{class:"button-container",children:f("input",{type:"submit",value:"",class:"button"})})]}),f("div",{id:"completeMessage",class:"complete-message",children:" "})]}),f("footer",{children:"(c) OmuQuest"})]})}),f("script",{src:"https://cdn.jsdelivr.net/npm/@supabase/supabase-js"}),f("script",{type:"text/javascript",src:"static/main.js",defer:!0}),f("script",{type:"text/javascript",src:"static/omuregist.js",defer:!0})]})));Pe.get("/omuregcomplete",r=>r.render(f("html",{children:[f("title",{children:""}),f("link",{rel:"stylesheet",href:"static/style.css"}),f("link",{rel:"stylesheet",href:"static/omuregcomplete.css"}),f(Cn,{children:[f("div",{id:"map"}),f("div",{class:"content","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:[f("form",{id:"uploadForm",enctype:"multipart/form-data",children:[f("label",{for:"file",children:":"}),f("input",{type:"file",id:"file",name:"file",required:!0}),f("br",{}),f("br",{}),f("button",{type:"submit",children:""})]}),f("div",{id:"completeMessage",class:"complete-message",children:""})]})]}),f("script",{src:"https://cdn.jsdelivr.net/npm/@supabase/supabase-js"}),f("script",{src:"static/main.js",defer:!0}),f("script",{type:"text/javascript",src:"static/omuregcomplete.js",defer:!0})]})));Pe.get("/station",r=>{const e=r.req.query("station_id"),t=r.req.query("station_name");return console.log(`/station ${e},${t}`),r.render(f("html",{children:[f("meta",{charset:"UTF-8"}),f("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),f("title",{children:""}),f("link",{rel:"stylesheet",href:"static/style.css"}),f("link",{rel:"stylesheet",href:"static/station.css"}),f(Cn,{children:[f("div",{class:"content","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:[" ",f("br",{}),": 33",f("br",{}),f("br",{}),": 15",f("br",{}),": 13",f("br",{}),"6: ",f("br",{}),"7: ",f("br",{}),"4: ",f("br",{}),"3: ",f("br",{})]}),f("div",{class:"input-window","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:[f("div",{class:"title-bar",children:[f("span",{class:"title",children:""}),f("div",{class:"buttons",children:[f("button",{class:"minimize",children:"-"}),f("button",{class:"close",children:"x"})]})]}),f("div",{class:"contentb","data-simplebar":!0,"data-simplebar-auto-hide":"false",children:f("form",{id:"uploadForm",method:"post",enctype:"multipart/form-data",children:[f("div",{class:"text",children:[f("label",{for:"station",children:""}),f("input",{type:"text",name:"station",id:"station",value:"",required:!0})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"shoutengai",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"shoutengai",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"shoutengai",value:"0"}),"  ",f("br",{})]})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"michi",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"michi",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"michi",value:"0"}),"  ",f("br",{})]})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"furuiMise",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"furuiMise",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"furuiMise",value:"0"}),"  ",f("br",{})]})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"shokuSample",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"shokuSample",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"shokuSample",value:"2"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"shokuSample",value:"0"}),"  ",f("br",{})]})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"building",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"building",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"building",value:"2"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"building",value:"0"}),"  ",f("br",{})]})]}),f("fieldset",{class:"choices",children:[f("legend",{children:""}),f("label",{children:[f("input",{type:"radio",name:"chain",value:"10"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"chain",value:"7"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"chain",value:"5"}),"  ",f("br",{})]}),f("label",{children:[f("input",{type:"radio",name:"chain",value:"2"}),"  ",f("br",{})]})]}),f("div",{class:"file-upload",children:[f("label",{for:"file",children:""}),f("input",{type:"file",id:"file",name:"file",accept:"image/*"})]}),f("div",{class:"button-container",children:f("input",{type:"submit",value:"",class:"button"})})]})}),f("footer",{children:"(c) OmuQuest"})]})]}),f("script",{src:"https://cdn.jsdelivr.net/npm/@supabase/supabase-js"}),f("script",{src:"static/main.js",defer:!0}),f("script",{type:"text/javascript",src:"static/station.js",defer:!0})]}))});Pe.get("/getEnv",r=>{const e={supabaseUrl:r.env.SUPABASE_API_URL,supabaseKey:r.env.SUPABASE_API_KEY};return r.json(e,200)});function ey(r){return r?parseInt(r,10):void 0}function Mo(r){return r?parseFloat(r):void 0}Pe.get("/fetchOmuIndexData",async r=>{const e=r.req.query("station_name"),t=ey(r.req.query("station_id")),s=Mo(r.req.query("lat")),n=Mo(r.req.query("lng"));if(!e||!t||!s||!n)return r.json({error:"Missing required query parameters"},400);let i=await rl(e,t,s,n);return i||(i={index:0,stationName:e,station_id:t,lat:s,lng:n}),r.json(i,200)});Pe.get("/fetchStationIds",async r=>{const e=r.req.query("sw_lat"),t=r.req.query("sw_lng"),s=r.req.query("ne_lat"),n=r.req.query("ne_lng");if(!e||!t||!s||!n)return r.json({error:"Missing required query parameters"},400);const i=parseFloat(e),a=parseFloat(t),o=parseFloat(s),c=parseFloat(n);if(isNaN(i)||isNaN(a)||isNaN(o)||isNaN(c))return r.json({error:"Invalid query parameter values"},400);const l=await Yf(i,a,o,c);return l?r.json(l,200):r.json({error:"fetchStationIds Error"},500)});Pe.get("/getOmuIndexByID",async r=>{const e=r.req.query("station_id");if(!e)return r.json({error:"Missing station_id"},400);const t={openaiApiKey:r.env.OPENAI_API_KEY,googleApiKey:r.env.GOOGLE_API_KEY,gyazoApiKey:r.env.GYAZO_ACCESS_TOKEN};try{const s=await Qg(t,e);return console.log(s),r.json(s)}catch(s){return console.error("Error fetching Omu Index by ID:",s),r.json({error:"Failed to fetch Omu Index"},500)}});const ty=I.object({station:I.string(),shoutengai:I.string().nullable(),michi:I.string().nullable(),furui_mise:I.string().nullable(),shoku_sample:I.string().nullable(),building:I.string().nullable(),chain:I.string().nullable(),userLat:I.number(),userLng:I.number(),fileName:I.string(),image:I.string()});Pe.post("/uploadStation",async r=>{try{const e=await r.req.json(),t=ty.parse(e),s=Ou(r.env.GYAZO_ACCESS_TOKEN,t.image,t.fileName);if(s==null)return r.json({message:"Image file upload error"},400);console.log("URL: ",s);const n=await sl(t.station,t.userLat,t.userLng),i=await tl(n,t.shoutengai,t.michi,t.furui_mise,t.shoku_sample,t.building,t.chain);return r.json({message:"Upload successful",data:t},200)}catch(e){return console.error("Upload Error:",e),e instanceof Error?r.json({message:"Invalid request",error:e.message},400):r.json({message:"Invalid request"},400)}});const ry=I.object({station:I.string(),egg:I.number(),rice:I.number(),sauce:I.number(),userLat:I.number(),userLng:I.number(),fileName:I.string(),image:I.string()});Pe.post("/uploadOmurice",async r=>{try{const e=await r.req.json(),t=ry.parse(e),s=await Ou(r.env.GYAZO_ACCESS_TOKEN,t.image,t.fileName);if(s==null)return r.json({message:"Image file upload error"},400);console.log("URL: ",s);const n=await sl(t.station,t.userLat,t.userLng),i=await nm(t.station,n,t.egg,t.rice,t.sauce,s);return r.json({message:"Upload successful",data:t},200)}catch(e){return console.error("Upload Error:",e),e instanceof Error?r.json({message:"Invalid request",error:e.message},400):r.json({message:"Invalid request"},400)}});const Lo=new Xi,sy=Object.assign({"/src/index.tsx":Pe});let Pu=!1;for(const[,r]of Object.entries(sy))r&&(Lo.route("/",r),Lo.notFound(r.notFoundHandler),Pu=!0);if(!Pu)throw new Error("Can't import modules from ['/src/index.tsx']");var ny=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const iy=Xd(ny),ay=Object.freeze(Object.defineProperty({__proto__:null,default:iy},Symbol.toStringTag,{value:"Module"}));export{Lo as default};
